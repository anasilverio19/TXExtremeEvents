---
title: "CH1Results"
author: "Ana Silverio"
date: "2023-10-20"
output:
  pdf_document: default
  html_document:
    df_print: paged
editor_options:
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, cache = TRUE, warning = FALSE, message = FALSE)

#This r markdown will be the compiled figures for the new baseline calculations that were decided at the october 4th committee meeting. This has similar figures to Manuscript_FiguresV1 (V1 = version 1) Instead of replacing all the chunks i wanted to keep it in order to look back at the original calculations. These calculations averaged recruitment windows and where the writing of the results will be based out of


#Set working directory:
setwd("~/texas_extreme_events")

#Call in bag seines:
bag.seines <- read.csv("~/texas_extreme_events/Clean_TPWD_Data/UpdatedBagSeinesCondensed_CLEAN.csv")

#Packages:
library(tidyverse)
library(lubridate)
library(knitr)
options(digits = 3)
library(ggforce)
library(tidyverse)
library("hrbrthemes")
library(viridis)
library(forcats)
library(ggpubr)
library(kableExtra)
library(magick)
library(webshot2)

#color palette
colorBlindBlack8 <- c("#000000","#0072B2",  "#56B4E9","#009E73", "#F0E442", "#E69F00","#D55E00","#CC79A7")

#readable dates:
str(bag.seines)
bag.seines$DATE<- as.Date(bag.seines$DATE,
                                        format = "%m/%d/%y")

#adding the names of the bays into the data frame
bag.seines$MAJOR_AREA_CODE <- as.factor(bag.seines$MAJOR_AREA_CODE)

bag.seines <- bag.seines %>%  
  dplyr::mutate(MAJOR_AREA_CODE = recode(MAJOR_AREA_CODE, `1` = 'SabineLake', `2` = 'GalvestonBay', `3` = 'MatagordaBay', `4` = 'SanAntonioBay', `5`= 'AransasBay', `6`='CorpusChristiBay', `7`='UpperLagunaMadre', `8` = 'LowerLagunaMadre', `9`='EastMatagordaBay', `11` = 'CedarLakes'))

bag.seines <- bag.seines %>% 
  filter(!(MAJOR_AREA_CODE == "CedarLakes")) %>% 
  filter(!(MAJOR_AREA_CODE == "EastMatagordaBay"))

##Plot
My_Theme <- theme(
  axis.title.x = element_text(size = 16),
  axis.text.x = element_text(size = 16),
  axis.title.y = element_text(size = 16),
  plot.title = element_text(size = 16),
  legend.text = element_text(size = 16),
  legend.title = element_text(size = 16),
  axis.ticks.length = unit(0.20, "cm"),
  axis.text.y = element_text(size = 16))



```

#Time series Figures 2 calculations
```{r Data experiment 1 Monthly Analysis Calculations, include=FALSE}
#calculate monthly averages:
#adding the names of the bays into the data frame
bag.seines$MAJOR_AREA_CODE <- as.factor(bag.seines$MAJOR_AREA_CODE)


## Red drum Monthly Average Calculations -----
redDrum_mon_avg <- bag.seines %>%
  group_by(MONTH,YEAR,MAJOR_AREA_CODE) %>%
  summarize(mean(rd_CPUE))

redDrum_mon_avg <- redDrum_mon_avg %>%
  rename("CPUE_AvgRD" = "mean(rd_CPUE)")


# making column that combines month and year
redDrum_mon_avg$DAY <- 1
redDrum_mon_avg$MDY <- paste(redDrum_mon_avg$MONTH,redDrum_mon_avg$DAY, redDrum_mon_avg$YEAR, sep = "-")
redDrum_mon_avg$MDY <- as.Date(redDrum_mon_avg$MDY, format = "%m-%d-%Y")


## Spotted seatrout Calculation ------
sst_mon_avg <- bag.seines %>%
  group_by(MONTH,YEAR,MAJOR_AREA_CODE) %>%
  summarize(mean(sst_CPUE))

sst_mon_avg <- sst_mon_avg %>%
  rename("CPUE_AvgSST" = "mean(sst_CPUE)")

#sst_mon_avg$MAJOR_AREA_CODE <- as.character(sst_mon_avg$MAJOR_AREA_CODE)

#creating a data column for easier interpretation 
sst_mon_avg$DAY <- 1
sst_mon_avg$MDY <- paste(sst_mon_avg$MONTH,sst_mon_avg$DAY, sst_mon_avg$YEAR, sep = "-")
sst_mon_avg$MDY <- as.Date(sst_mon_avg$MDY, format = "%m-%d-%Y")



#Black drum calculation ---- 
blackDrum_mon_avg <- bag.seines %>%
  group_by(MONTH,YEAR,MAJOR_AREA_CODE) %>%
  summarize(mean(bd_CPUE))

blackDrum_mon_avg  <- blackDrum_mon_avg  %>%
  rename("CPUE_AvgBD" = "mean(bd_CPUE)")

blackDrum_mon_avg$MAJOR_AREA_CODE <- as.character(blackDrum_mon_avg$MAJOR_AREA_CODE)

## creating a data column
blackDrum_mon_avg$DAY <- 1
blackDrum_mon_avg$MDY <- paste(blackDrum_mon_avg$MONTH,blackDrum_mon_avg$DAY, blackDrum_mon_avg$YEAR, sep = "-")
blackDrum_mon_avg$MDY <- as.Date(blackDrum_mon_avg$MDY, format = "%m-%d-%Y")


## Southern Flounder calculation ----

SF_mon_avg <- bag.seines %>%
  group_by(MONTH,YEAR,MAJOR_AREA_CODE) %>%
  summarize(mean(sf_CPUE))

SF_mon_avg  <- SF_mon_avg %>%
  rename("CPUE_AvgSF" = "mean(sf_CPUE)")

SF_mon_avg$MAJOR_AREA_CODE <- as.character(SF_mon_avg$MAJOR_AREA_CODE)

#Creating a data column for easier plot interpretation
SF_mon_avg$DAY <- 1
SF_mon_avg$MDY <- paste(SF_mon_avg$MONTH,SF_mon_avg$DAY, SF_mon_avg$YEAR, sep = "-")
SF_mon_avg$MDY <- as.Date(SF_mon_avg$MDY, format = "%m-%d-%Y")




```

```{r Data Experiment 1 plots Hurricane Harvey, echo=FALSE}

## red drum plot
ggplot(data = redDrum_mon_avg %>% filter(YEAR > 2013), mapping = aes(x = MDY, y =  CPUE_AvgRD, color = MAJOR_AREA_CODE)) + geom_line(alpha = 0.8, size = 1) +  
geom_vline(xintercept = as.numeric(as.Date("2017-08-01")), linetype=4, size = 1, color = "#000000") + 
geom_vline(xintercept = as.numeric(as.Date("2021-02-01")), linetype=4, size=1, color = "#000000") +
theme_classic() + #facet_wrap(~MAJOR_AREA_CODE, scales = "free") +
   scale_x_date(date_labels = "%Y", date_breaks = "1 year") +
  labs(
  title = "Red Drum CPUE Monthly Average Since 2014",
  x = "Time",
  y = "CPUE (#/hectare)" 
) + theme(axis.text.x = element_text(angle=45, hjust=1))


#spotted seatrout plot
ggplot(data = sst_mon_avg %>% filter(YEAR > 2013), mapping = aes(x = MDY, y =  CPUE_AvgSST, color = MAJOR_AREA_CODE)) + geom_line(alpha = 0.8, size = 1) + theme_classic() +#facet_wrap(~MAJOR_AREA_CODE, scale = "free") +  
  geom_vline(xintercept = as.numeric(as.Date("2017-08-01")), linetype=4, size = 1, color = "#000000")+
  geom_vline(xintercept = as.numeric(as.Date("2021-02-01")), linetype=4, size = 1, color = "#000000") +
  scale_x_date(date_labels = "%Y", date_breaks = "1 year") +
  labs(
    title = "Spotted Seatrout CPUE Monthly Average since 2014",
    x = "Time",
    y = "CPUE (#/hectare)"
  )+ theme(axis.text.x = element_text(angle=45, hjust=1))



## black drum plot
ggplot(data = blackDrum_mon_avg  %>% filter(YEAR > 2013), mapping = aes(x = MDY, y =  CPUE_AvgBD, color = MAJOR_AREA_CODE)) + geom_line(alpha = 0.8, size = 1) + theme_classic() +#facet_wrap(~MAJOR_AREA_CODE, scale = "free") +  
  geom_vline(xintercept = as.numeric(as.Date("2017-08-01")), linetype=4, size = 1, color = "#000000")+
  geom_vline(xintercept = as.numeric(as.Date("2021-02-01")), linetype=4, size = 1, color = "#000000") +
  scale_x_date(date_labels = "%Y", date_breaks = "1 year") +
 labs(
  title = "Black Drum CPUE Monthly Average since 2014",
  x = "Time",
  y = "CPUE (#/hectare)"
) + theme(axis.text.x = element_text(angle=45, hjust=1))

#b



## southern flounder plot
ggplot(data = SF_mon_avg %>% filter(YEAR > 2013), mapping = aes(x = MDY, y =  CPUE_AvgSF, color = MAJOR_AREA_CODE)) + geom_line(alpha = 0.8, size = 1) + theme_classic() + #facet_wrap(~MAJOR_AREA_CODE, scale = "free") +  
  geom_vline(xintercept = as.numeric(as.Date("2017-08-01")), linetype=4, size = 1, color = "#000000")+
  geom_vline(xintercept = as.numeric(as.Date("2021-02-01")), linetype=4, size = 1, color = "#000000") +
  scale_x_date(date_labels = "%Y", date_breaks = "1 year") +
  labs(
  title = "Southern Flounder CPUE Monthly Average since 2014",
  x = "Time",
  y = "CPUE (#/hectare)"
) + theme(axis.text.x = element_text(angle=45, hjust=1))

#sf

#ggsave("SF_Draft.jpg", width = 10, height = 8, units = c("in"), dpi = 300)

```

# Figure 2 compilation
```{r ggarrange into 4 pannel figure for figure 2}

rd <- ggplot(data = redDrum_mon_avg %>% filter(YEAR > 2013), mapping = aes(x = MDY, y =  CPUE_AvgRD, color = MAJOR_AREA_CODE)) + geom_line(alpha = 0.8, size = 1) +  My_Theme +
   scale_color_manual(values = colorBlindBlack8) +
geom_vline(xintercept = as.numeric(as.Date("2017-08-01")), linetype=4, size = 1, color = "#000000") + 
geom_vline(xintercept = as.numeric(as.Date("2021-02-01")), linetype=4, size=1, color = "#000000") +
theme_classic() + My_Theme +
   scale_x_date(date_labels = "%Y", date_breaks = "1 year") +
  labs(
  title = "Red Drum",
  x = "Time",
  color = "Bays"
) + theme(axis.text.x = element_text(angle=45, hjust=1)) 


sst <- ggplot(data = sst_mon_avg %>% filter(YEAR > 2013), mapping = aes(x = MDY, y =  CPUE_AvgSST, color = MAJOR_AREA_CODE)) + geom_line(alpha = 0.8, size = 1) + theme_classic() +
   scale_color_manual(values = colorBlindBlack8) + My_Theme +
  geom_vline(xintercept = as.numeric(as.Date("2017-08-01")), linetype=4, size = 1, color = "#000000")+
  geom_vline(xintercept = as.numeric(as.Date("2021-02-01")), linetype=4, size = 1, color = "#000000") +
  scale_x_date(date_labels = "%Y", date_breaks = "1 year") +
  labs(
    title = "Spotted Seatrout",
    x = "Time",
    color = "Bays"
  )+ theme(axis.text.x = element_text(angle=45, hjust=1))

bd <- ggplot(data = blackDrum_mon_avg  %>% filter(YEAR > 2013), mapping = aes(x = MDY, y =  CPUE_AvgBD, color = MAJOR_AREA_CODE)) + geom_line(alpha = 0.8, size = 1) + theme_classic() + My_Theme +
   scale_color_manual(values = colorBlindBlack8) +
  geom_vline(xintercept = as.numeric(as.Date("2017-08-01")), linetype=4, size = 1, color = "#000000")+
  geom_vline(xintercept = as.numeric(as.Date("2021-02-01")), linetype=4, size = 1, color = "#000000") +
  scale_x_date(date_labels = "%Y", date_breaks = "1 year") +
 labs(
  title = "Black Drum",
  x = "Time",
  color = "Bays"
) + theme(axis.text.x = element_text(angle=45, hjust=1)) + ylim(0,350)

sf <- ggplot(data = SF_mon_avg %>% filter(YEAR > 2013), mapping = aes(x = MDY, y =  CPUE_AvgSF, color = MAJOR_AREA_CODE)) + geom_line(alpha = 0.8, size = 1) + theme_classic() + My_Theme + #facet_wrap(~MAJOR_AREA_CODE, scale = "free") +
  scale_color_manual(values = colorBlindBlack8) +
  geom_vline(xintercept = as.numeric(as.Date("2017-08-01")), linetype=4, size = 1, color = "#000000")+
  geom_vline(xintercept = as.numeric(as.Date("2021-02-01")), linetype=4, size = 1, color = "#000000") +
  scale_x_date(date_labels = "%Y", date_breaks = "1 year") +
  labs(
  title = "Southern Flounder",
  x = "Time",
  color = "Bays"
) + theme(axis.text.x = element_text(angle=45, hjust=1))

# arrange all 4 plots into 1 figure -----
time_series <- ggarrange(rd + rremove("ylab") + rremove("xlab"), sst +rremove("ylab") + rremove("xlab"), bd+rremove("ylab") + rremove("xlab"), sf+rremove("ylab") + rremove("xlab"), labels = NULL, common.legend = TRUE,ncol = 2, nrow = 2, legend = "top", font.label = list(size = 13, face = "bold"))

time_series

annotate_figure(time_series,
                bottom = text_grob("Time", size = 16, hjust = 1),
                left = text_grob("CPUE (#/hectare)", rot = 90, size = 16))


#annotate_figure(aransas_gn_plot, top = text_grob("Aransas Bay Gill Nets and Winter Storm Uri", color = "#8B0000", face = "bold", size = 14))

#ggsave("Figure2_edited.jpg", width = 10, height = 8, units = c("in"), dpi = 300, bg = "white")

```

```{r table 1 creation}
library(knitr)
## Past 10 years (to represent the gradient)
enviro_table <- bag.seines %>%
  #filter(YEAR > 2013 & YEAR < 2024 ) %>% 
  #group_by(MAJOR_AREA_CODE) %>% 
  #summarise_at(.var = c("START_TEMPERATURE_NUM", "START_SALINITY_NUM"), .funs =   mean)

enviro_tableSD <- bag.seines %>%
  #filter(YEAR > 2013 & YEAR < 2024 ) %>% 
 #group_by(MAJOR_AREA_CODE) %>% 
  #summarise_at(.var = c("START_TEMPERATURE_NUM", "START_SALINITY_NUM"), .funs =   sd)

#merge
enviro_join <- merge(enviro_table, enviro_tableSD, by = "MAJOR_AREA_CODE")
enviro_join$MAJOR_AREA_CODE <- factor(enviro_join$MAJOR_AREA_CODE , levels = c("SabineLake", "GalvestonBay", "MatagordaBay", "SanAntonioBay", "AransasBay", "CorpusChristiBay", "UpperLagunaMadre", "LowerLagunaMadre"))

write.csv(enviro_join, "~/texas_extreme_events/enviro_join2.csv", row.names=FALSE)


```

```{r table 1 enviornmental gradients}
table1 <- read.csv("~/texas_extreme_events/enviro_joinV2.csv")

table1$MAJOR_AREA_CODE <- as.factor(table1$MAJOR_AREA_CODE)

table1$`MAJOR_AREA_CODE` <- factor(table1$`MAJOR_AREA_CODE` , levels = c("Sabine Lake", "Galveston Bay", "Matagorda Bay", "San Antonio Bay", "Aransas Bay", "Corpus Christi Bay", "Upper Laguna Madre", "Lower Laguna Madre"))
levels(table1$`MAJOR_AREA_CODE`)

table1 <- table1 %>% 
  rename("Major Bay" = "MAJOR_AREA_CODE") %>% 
  rename("Average Temp (Celsius)" = "START_TEMPERATURE_NUM.x") %>% 
  rename("Average Salinity (ppt)" = "START_SALINITY_NUM.x") %>% 
  rename("Standard Deviation Temp" = "START_TEMPERATURE_NUM.y") %>% 
  rename("Standard Deviation Salinity" = "START_SALINITY_NUM.y")

#rearrange
table1 <- table1 %>% relocate(`Standard Deviation Temp`, .after=`Average Temp (Celsius)`)


table1$`Major Bay` <- trimws(table1$`Major Bay`)

kbl(table1, booktabs = T) %>%
kable_styling(latex_options = c("striped", "scale_down"))

```

\newpage

# Table 2

```{r table 2 bay features}

# call in data frame
table2 <- read.csv("~/texas_extreme_events/Table1_ExcelV2.csv")

library(knitr)

table2 <- table2 %>% 
  rename("Major Bay" = "Major.Bay") %>% 
  rename("Average Depth (m)" = "Mean.Depth..m.") %>% 
  rename("Max Depth (Dredged (m))" = "Max.Depth..Dredged..m..") %>% 
  rename("Max Dpeth (Non Dredged (m))"= "Max.Depth..Non.Dredged..m..") %>% 
  rename("Surface Area (ha)" = "Surface.Area..ha.") %>% 
  rename("Volume (km3)" = "Volumn..km3.")

table2 <- table2[-8,]


kbl(table2, booktabs = T) %>%
kable_styling(latex_options = c("striped", "scale_down"))


```





# Table 3
```{r Table for fish biology}
# call in data frame
FishBiology <- read.csv("~/texas_extreme_events/FishBiology.csv")

library(knitr)

FishBiology  <- FishBiology %>%
  rename("Recruitment Window" = "Recruitment.Window") %>% 
  rename("Spawning Season" = "Spawning.season")

knitr::kable(FishBiology, "pipe")

  

```



# Pulse Recruitment
```{r Patterns for each species }
###Plotting the raw data points starts here####
#plot
ggplot(data = bag.seines %>% filter(YEAR > 2006 & YEAR < 2017), mapping = aes(x = as.Date(JULIAN_DATE, origin = as.Date("2021-01-01")), y = rd_CPUE, group=as.factor(YEAR), color = as.factor(YEAR))) + geom_point() + #geom_smooth() +
  theme_classic() + #facet_wrap(~MAJOR_AREA_CODE) +
  scale_x_date(date_labels = "%b", date_breaks = "1 month") +
  labs(
    title = "Red Drum CPUE Monthly Average Since 2007",
    x = "Time",
    y = "CPUE (#/hectare)" 
  )


ggplot(data = bag.seines %>% filter(YEAR > 2006 & YEAR < 2017), mapping = aes(x = as.Date(JULIAN_DATE, origin = as.Date("2021-01-01")), y = (sst_CPUE), group=as.factor(YEAR), color = as.factor(YEAR))) + geom_point() + #geom_smooth() +
  theme_classic() + #facet_wrap(~MAJOR_AREA_CODE) +
  scale_x_date(date_labels = "%b", date_breaks = "1 month") +
  labs(
    title = "SST CPUE Monthly Average Since 2007",
    x = "Time",
    y = "CPUE (#/hectare)" 
  )


ggplot(data = bag.seines %>% filter(YEAR > 2006 & YEAR < 2017), mapping = aes(x = as.Date(JULIAN_DATE, origin = as.Date("2021-01-01")), y = bd_CPUE, group=as.factor(YEAR), color = as.factor(YEAR))) + geom_point() + #geom_smooth() +
  theme_classic() + #facet_wrap(~MAJOR_AREA_CODE) +
  scale_x_date(date_labels = "%b", date_breaks = "1 month") +
  labs(
    title = "black drum CPUE Monthly Average Since 2007",
    x = "Time",
    y = "CPUE (#/hectare)" 
  ) + ylim(0,4000)


ggplot(data = bag.seines %>% filter(YEAR > 2006 & YEAR < 2017), mapping = aes(x = as.Date(JULIAN_DATE, origin = as.Date("2021-01-01")), y = sf_CPUE, group=as.factor(YEAR), color = as.factor(YEAR))) + geom_point() + #geom_smooth() +
  theme_classic() + #facet_wrap(~MAJOR_AREA_CODE) +
  scale_x_date(date_labels = "%b", date_breaks = "1 month") +
  labs(
    title = "Southern Flounder CPUE Monthly Average Since 2007",
    x = "Time",
    y = "CPUE (#/hectare)" 
  )



```

```{r recruitment windows verification, include=FALSE}
## Red drum trial with hurricane event
#make testing dataframes
oneyear <- bag.seines %>% 
  filter(between(DATE, as.Date('2007-10-01'), as.Date('2008-05-31'))) %>%
  group_by(MAJOR_AREA_CODE) 
  
lowyear <- bag.seines %>% 
  filter(between(DATE, as.Date('2007-06-01'), as.Date('2007-09-30'))) %>%   group_by(MAJOR_AREA_CODE)

#plot testing dataframes
ggplot(oneyear, mapping = aes(x = DATE, y = rd_CPUE)) + geom_point() + theme_classic() + 
  ylim(0, 1500)

ggplot(lowyear, mapping = aes(x = DATE, y = rd_CPUE)) + geom_point() + theme_classic() +
  ylim(0, 1500)
## shows the variation of CPUE throughout the year because of their spawning and recruitment behaviors

###### Trial with spotted seatrout to define the recruitment window 

#make testing dataframes
SSTtest <- bag.seines %>% 
  filter(between(DATE, as.Date('2007-06-01'), as.Date('2007-12-31'))) %>%
  group_by(MAJOR_AREA_CODE) 

SSTlowcheck <- bag.seines %>% 
  filter(between(DATE, as.Date('2007-01-01'), as.Date('2007-05-31'))) %>%   group_by(MAJOR_AREA_CODE)

#plot testing dataframes
ggplot(SSTtest, mapping = aes(x = DATE, y = sst_CPUE)) + geom_point() + theme_classic() + 
  ylim(0, 700)

ggplot(SSTlowcheck, mapping = aes(x = DATE, y = sst_CPUE)) + geom_point() + theme_classic() +
  ylim(0, 700)
## shows the variation of CPUE throughout the year because of their spawning and recruitment behaviors

## shows the recruitment window more closely between june and end of dec?? moving the sst calculations to a new script


###### Trial with black drum 
#make testing dataframes
BDtest <- bag.seines %>% 
  filter(between(DATE, as.Date('2007-04-01'), as.Date('2007-10-31'))) %>%
  group_by(MAJOR_AREA_CODE) 

BDlowcheck1 <- bag.seines %>% 
  filter(between(DATE, as.Date('2007-01-01'), as.Date('2007-03-31'))) %>% group_by(MAJOR_AREA_CODE)

BDlowcheck2 <- bag.seines %>% 
  filter(between(DATE, as.Date('2007-11-01'), as.Date('2007-12-31'))) %>% group_by(MAJOR_AREA_CODE)

#plot testing dataframes
ggplot(BDtest, mapping = aes(x = DATE, y = bd_CPUE)) + geom_point() + theme_classic() + ylim(0, 1000)

ggplot(BDlowcheck1, mapping = aes(x = DATE, y = bd_CPUE)) + geom_point() + theme_classic() + ylim(0, 1000)

ggplot(BDlowcheck2, mapping = aes(x = DATE, y = bd_CPUE)) + geom_point() + theme_classic() + ylim(0, 1000)


## shows the variation of CPUE throughout the year because of their spawning and recruitment behaviors

## shows the recruitment window is April thru end of october moving the bd calculations to a new script


###### Trial with southern flounder
#make testing dataframes
SFtest <- bag.seines %>% 
  filter(between(DATE, as.Date('2007-02-01'), as.Date('2007-07-31'))) %>%
  group_by(MAJOR_AREA_CODE) 

SFlowcheck1 <- bag.seines %>% 
  filter(between(DATE, as.Date('2007-08-01'), as.Date('2008-01-31'))) %>% group_by(MAJOR_AREA_CODE)



#plot testing dataframes
ggplot(SFtest, mapping = aes(x = DATE, y = sf_CPUE)) + geom_point() + theme_classic() + ylim(0, 2500)

ggplot(SFlowcheck1, mapping = aes(x = DATE, y = sf_CPUE)) + geom_point() + theme_classic() + ylim(0, 2500)



## shows the variation of CPUE throughout the year because of their spawning and recruitment behaviors

## shows the recruitment window is feb to end of july moving the sf calculations to a new script
```


## Notes

From here I am able to look at the recruitment windows for each species to better align my averages for each species moving forward

# New Baseline Calculations 

In the order of Hurricane, Freeze for each 

- Red Drum
- Spotted Seatrout
- Black Drum
- Southern Flounder

# Red Drum

```{r Red Drum Hurricane}
#I had to first subset into the 10 year frame I wanted (no averaging)
check2 <- bag.seines %>%
  filter(YEAR > 2006 & YEAR < 2018 ) %>% 
  group_by(MAJOR_AREA_CODE)

#Then I had to subset for only the months I wanted for red drum (oct - end of may)
check3 <- check2 %>% 
  filter(MONTH < 6 ) %>% 
  group_by(MAJOR_AREA_CODE)

check4 <- check2 %>% 
  filter(MONTH > 9) %>% 
  group_by(MAJOR_AREA_CODE)
#pasting them together
finalcheck <- rbind(check3, check4)
 
finalcheck <- finalcheck %>% 
  filter(DATE > "2007-09-30") %>% 
  filter(DATE < "2017-06-01")


ggplot(finalcheck, mapping = aes(x=JULIAN_DATE, y = rd_CPUE)) + geom_point() + theme_classic()

#Final step = Averaging for the baseline
RE.RD10yr.hurricane <- finalcheck %>% 
  group_by(MAJOR_AREA_CODE) %>% 
  summarize(mean(rd_CPUE)) %>% 
  rename("CPUE" = "mean(rd_CPUE)")

RE.RD10yr.hurricane$SPECIES <- "Red Drum"
RE.RD10yr.hurricane$AVERAGE <- "10 yrs"

## post storm calculations = 2 post storm recruitment windows
RE.RD1yr.hurricane <- bag.seines %>%
  filter(between(DATE, as.Date('2017-10-01'), as.Date('2018-05-31'))) %>% 
  group_by(MAJOR_AREA_CODE) %>%
  summarize(mean(rd_CPUE)) %>%
  rename("CPUE" = "mean(rd_CPUE)")

RE.RD1yr.hurricane$SPECIES <- "Red Drum"
RE.RD1yr.hurricane$AVERAGE <- "1st year"


RE.RD2nd.hurricane <- bag.seines %>%
  filter(between(DATE, as.Date('2018-10-01'), as.Date('2019-05-31'))) %>% 
  group_by(MAJOR_AREA_CODE) %>%
  summarize(mean(rd_CPUE)) %>%
  rename("CPUE" = "mean(rd_CPUE)")

RE.RD2nd.hurricane$SPECIES <- "Red Drum"
RE.RD2nd.hurricane$AVERAGE <- "2nd year"

RE.RDbyyear.Hurr <- rbind(RE.RD10yr.hurricane,RE.RD1yr.hurricane,RE.RD2nd.hurricane)


#Plotting
ggplot(data = RE.RDbyyear.Hurr , mapping = aes(x = MAJOR_AREA_CODE, y =  CPUE, fill = AVERAGE)) +  geom_bar(stat="identity", color="black", position=position_dodge()) + scale_fill_grey() + theme_classic() + labs(
  title = "10 yr avg vs post storm avg for RD across bays using NEW baselines",
  x = "Major bays",
  y = "Catch per Unit Effort (#/hectare)"
) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))


## PERCENT CHANGES
#make it wide:
RE.RD.Spread.PerChange <- spread(RE.RDbyyear.Hurr, AVERAGE, CPUE)

## Add the column to put in the percent change values
RE.RD.Spread.PerChange$first_perChange <- NA
RE.RD.Spread.PerChange$second_perChange <- NA

# for loop calculating per change for the first year
for (i in 1:nrow(RE.RD.Spread.PerChange)){
  RE.RD.Spread.PerChange$first_perChange[i] = format(((RE.RD.Spread.PerChange$`1st year`[i] - RE.RD.Spread.PerChange$`10 yrs`[i]) /RE.RD.Spread.PerChange$`10 yrs`[i]) * 100 , scientific = F)
}

#for loop for calculating per change for the 2nd year to the baseline = 
for (i in 1:nrow(RE.RD.Spread.PerChange)){
  RE.RD.Spread.PerChange$second_perChange[i] = format(((RE.RD.Spread.PerChange$`2nd year`[i] - RE.RD.Spread.PerChange$`10 yrs`[i]) /RE.RD.Spread.PerChange$`10 yrs`[i]) * 100 , scientific = F)
}

## Per change values need to be converted to numeric values before plotting

RE.RD.Spread.PerChange$first_perChange <- as.numeric(RE.RD.Spread.PerChange$first_perChange)

RE.RD.Spread.PerChange$second_perChange <- as.numeric(RE.RD.Spread.PerChange$second_perChange)

##Plot
RE.RD.Spread.PerChange %>%
  ggplot() +
  geom_point(aes(x=MAJOR_AREA_CODE, y=first_perChange), color = '#D81B60') + geom_point(aes(x=MAJOR_AREA_CODE, y = second_perChange), color = '#1E88E5') + theme_classic() + theme(axis.text.x = element_text(angle=90, hjust=1)) + geom_hline(yintercept = 0) + geom_segment(
    aes(x = MAJOR_AREA_CODE, y = first_perChange, xend = MAJOR_AREA_CODE, yend = second_perChange),
    arrow = arrow(length = unit(0.02, units = "npc")),
    size = 0.3
  ) + labs(
    y = "Percent Change",
    x = "Bay Location",
    color = "legend",
    title = "Red drum during hurricane harvey with NEW baselines"
  )

table <- RE.RD.Spread.PerChange
table <- table %>%  rename(
 "Bays" = "MAJOR_AREA_CODE"
)

kable(table, "latex", booktabs = T) %>% 
  kable_styling(latex_options = c( "scale_down"), full_width = F)
  

```

```{r Red Drum Freeze}

#Red Drum
#I had to first subset into the 10 year frame I wanted (no averaging)
subset2 <- bag.seines %>%
  filter(YEAR > 2008 & YEAR < 2020 ) %>% 
  group_by(MAJOR_AREA_CODE)
#summarize(mean(rd_CPUE)) %>%
#rename("CPUE" = "mean(rd_CPUE)")

#Then I had to subset for only the months I wanted for red drum (oct - end of may)
subset3 <- subset2 %>% 
  filter(MONTH < 6 ) %>% 
  group_by(MAJOR_AREA_CODE)

subset4 <- subset2 %>% 
  filter(MONTH > 9) %>% 
  group_by(MAJOR_AREA_CODE)
#pasting them together
finalsubset <- rbind(subset3, subset4)

## I realized that the data set has data from an incomplete recruitment window since it starts with 2009 in jan (this recruitment window would have started in oct of the previous year) so I need to make sure it starts in oct of 2009 and ends may of 2019 for the averages

finalsubset <- finalsubset %>% 
  filter(DATE > "2009-09-30") %>% 
  filter(DATE < "2019-06-01")


ggplot(finalsubset, mapping = aes(x=JULIAN_DATE, y = rd_CPUE)) + geom_point() + theme_classic()

#Final step = Averaging for the baseline
RE.RD10yr.freeze <- finalsubset %>% 
  group_by(MAJOR_AREA_CODE) %>% 
  summarize(mean(rd_CPUE)) %>% 
  rename("CPUE" = "mean(rd_CPUE)")

RE.RD10yr.freeze$SPECIES <- "Red Drum"
RE.RD10yr.freeze$AVERAGE <- "10 yrs"

## post storm calculations = 2 post storm recruitment windows
RE.RD1yr.freeze <- bag.seines %>%
  filter(between(DATE, as.Date('2021-10-01'), as.Date('2022-05-31'))) %>% 
  group_by(MAJOR_AREA_CODE) %>%
  summarize(mean(rd_CPUE)) %>%
  rename("CPUE" = "mean(rd_CPUE)")

RE.RD1yr.freeze$SPECIES <- "Red Drum"
RE.RD1yr.freeze$AVERAGE <- "1st year"


RE.RD2nd.freeze<- bag.seines %>%
  filter(between(DATE, as.Date('2022-10-01'), as.Date('2023-05-31'))) %>% 
  group_by(MAJOR_AREA_CODE) %>%
  summarize(mean(rd_CPUE)) %>%
  rename("CPUE" = "mean(rd_CPUE)")

RE.RD2nd.freeze$SPECIES <- "Red Drum"
RE.RD2nd.freeze$AVERAGE <- "2nd year"

RE.RDbyyear.Freeze <- rbind(RE.RD10yr.freeze,RE.RD1yr.freeze,RE.RD2nd.freeze)


#Plotting
ggplot(data = RE.RDbyyear.Freeze , mapping = aes(x = MAJOR_AREA_CODE, y =  CPUE, fill = AVERAGE)) +  geom_bar(stat="identity", color="black", position=position_dodge()) + scale_fill_grey() + theme_classic() + labs(
  title = "10 yr avg vs post freeze avg for RD across bays using NEW baselines",
  x = "Major bays",
  y = "Catch per Unit Effort (#/hectare)"
) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))


## PERCENT CHANGES
#make it wide:
RE.RD.freeze.PerChange <- spread(RE.RDbyyear.Freeze, AVERAGE, CPUE)

## Add the column to put in the percent change values
RE.RD.freeze.PerChange$first_perChange <- NA
RE.RD.freeze.PerChange$second_perChange <- NA

# for loop calculating per change for the first year
for (i in 1:nrow(RE.RD.freeze.PerChange)){
  RE.RD.freeze.PerChange$first_perChange[i] = format(((RE.RD.freeze.PerChange$`1st year`[i] - RE.RD.freeze.PerChange$`10 yrs`[i]) /RE.RD.freeze.PerChange$`10 yrs`[i]) * 100 , scientific = F)
}

#for loop for calculating per change for the 2nd year to the baseline = 
for (i in 1:nrow(RE.RD.freeze.PerChange)){
  RE.RD.freeze.PerChange$second_perChange[i] = format(((RE.RD.freeze.PerChange$`2nd year`[i] - RE.RD.freeze.PerChange$`10 yrs`[i]) /RE.RD.freeze.PerChange$`10 yrs`[i]) * 100 , scientific = F)
}

## Per change values need to be converted to numeric values before plotting

RE.RD.freeze.PerChange$first_perChange <- as.numeric(RE.RD.freeze.PerChange$first_perChange)

RE.RD.freeze.PerChange$second_perChange <- as.numeric(RE.RD.freeze.PerChange$second_perChange)

##Plot
RE.RD.freeze.PerChange %>%
  ggplot() +
  geom_point(aes(x=MAJOR_AREA_CODE, y=first_perChange), color = '#D81B60') + geom_point(aes(x=MAJOR_AREA_CODE, y = second_perChange), color = '#1E88E5') + theme_classic() + theme(axis.text.x = element_text(angle=90, hjust=1)) + geom_hline(yintercept = 0) + geom_segment(
    aes(x = MAJOR_AREA_CODE, y = first_perChange, xend = MAJOR_AREA_CODE, yend = second_perChange),
    arrow = arrow(length = unit(0.02, units = "npc")),
    size = 0.3
  ) + labs(
    y = "Percent Change",
    x = "Bay Location",
    color = "legend",
    title = "Red drum during freeze with NEW baselines"
  )

```




# Spotted Seatrout

```{r Spotted Seatrout Hurricane }

#I had to first subset into the 10 year frame I wanted (no averaging)
subset5 <- bag.seines %>%
  filter(YEAR > 2006 & YEAR < 2017 ) %>% 
  group_by(MAJOR_AREA_CODE)

#Then I had to subset for only the months I wanted for spotted seatrout (june - end of december)
subset6 <- subset5 %>% 
  filter(MONTH > 5 ) %>% 
  group_by(MAJOR_AREA_CODE)

ggplot(subset6, mapping = aes(x=JULIAN_DATE, y = sst_CPUE)) + geom_point() + theme_classic()

#Final step = Averaging for the baseline
RE.SST10yr.hurricane <- subset6 %>% 
  group_by(MAJOR_AREA_CODE) %>% 
  summarize(mean(sst_CPUE)) %>% 
  rename("CPUE" = "mean(sst_CPUE)")

RE.SST10yr.hurricane$SPECIES <- "Spotted Seatrout"
RE.SST10yr.hurricane$AVERAGE <- "10 yrs"

## post storm calculations = 2 post storm recruitment windows
RE.SST1yr.hurricane <- bag.seines %>%
  filter(between(DATE, as.Date('2018-06-01'), as.Date('2018-12-31'))) %>% 
  group_by(MAJOR_AREA_CODE) %>%
  summarize(mean(sst_CPUE)) %>%
  rename("CPUE" = "mean(sst_CPUE)")

RE.SST1yr.hurricane$SPECIES <- "Spotted Seatrout"
RE.SST1yr.hurricane$AVERAGE <- "1st year"


RE.SST2nd.hurricane <- bag.seines %>%
  filter(between(DATE, as.Date('2019-06-01'), as.Date('2019-12-31'))) %>% 
  group_by(MAJOR_AREA_CODE) %>%
  summarize(mean(sst_CPUE)) %>%
  rename("CPUE" = "mean(sst_CPUE)")

RE.SST2nd.hurricane$SPECIES <- "Spotted Seatrout"
RE.SST2nd.hurricane$AVERAGE <- "2nd year"

RE.SSTbyyear.Hurr <- rbind(RE.SST10yr.hurricane,RE.SST1yr.hurricane,RE.SST2nd.hurricane)


#Plotting
ggplot(data = RE.SSTbyyear.Hurr , mapping = aes(x = MAJOR_AREA_CODE, y =  CPUE, fill = AVERAGE)) +  geom_bar(stat="identity", color="black", position=position_dodge()) + scale_fill_grey() + theme_classic() + labs(
  title = "10 yr avg vs post storm avg for SST across bays using NEW baselines",
  x = "Major bays",
  y = "Catch per Unit Effort (#/hectare)"
) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

## PERCENT CHANGES
#make it wide:
RE.SST.Spread.PerChange <- spread(RE.SSTbyyear.Hurr, AVERAGE, CPUE)

## Add the column to put in the percent change values
RE.SST.Spread.PerChange$first_perChange <- NA
RE.SST.Spread.PerChange$second_perChange <- NA

# for loop calculating per change for the first year
for (i in 1:nrow(RE.SST.Spread.PerChange)){
  RE.SST.Spread.PerChange$first_perChange[i] = format(((RE.SST.Spread.PerChange$`1st year`[i] - RE.SST.Spread.PerChange$`10 yrs`[i]) /RE.SST.Spread.PerChange$`10 yrs`[i]) * 100 , scientific = F)
}

#for loop for calculating per change for the 2nd year to the baseline = 
for (i in 1:nrow(RE.SST.Spread.PerChange)){
  RE.SST.Spread.PerChange$second_perChange[i] = format(((RE.SST.Spread.PerChange$`2nd year`[i] - RE.SST.Spread.PerChange$`10 yrs`[i]) /RE.SST.Spread.PerChange$`10 yrs`[i]) * 100 , scientific = F)
}

## Per change values need to be converted to numeric values before plotting

RE.SST.Spread.PerChange$first_perChange <- as.numeric(RE.SST.Spread.PerChange$first_perChange)

RE.SST.Spread.PerChange$second_perChange <- as.numeric(RE.SST.Spread.PerChange$second_perChange)

##Plot
My_Theme <- theme(
  axis.title.x = element_text(size = 12),
  axis.text.x = element_text(size = 12),
  axis.title.y = element_text(size = 12),
  plot.title = element_text(size = 12),
  legend.text = element_text(size = 12),
  legend.title = element_text(size = 12),
  axis.ticks.length = unit(0.20, "cm"),
  axis.text.y = element_text(size = 12))


RE.SST.Spread.PerChange %>%
  ggplot() +
  geom_point(aes(x=MAJOR_AREA_CODE, y=first_perChange, color = 'First Year'), size = 5) + geom_point(aes(x=MAJOR_AREA_CODE, y = second_perChange, color = 'Second Year'), size = 5) + theme_classic() + theme(axis.text.x = element_text(angle=45, hjust=1)) +
  My_Theme + scale_color_manual(values = c("#D81B60", "#1E88E5")) +
  geom_hline(yintercept = 0) + geom_segment(
    aes(x = MAJOR_AREA_CODE, y = first_perChange, xend = MAJOR_AREA_CODE, yend = second_perChange),
    arrow = arrow(length = unit(0.04, units = "npc")),
    size = 0.5
  ) + scale_y_continuous(n.breaks = 20 ) + labs(
    y = "Percent Change (%)",
    x = "Bay Location",
    colour = "Post Storm"
  )



kable(RE.SST.Spread.PerChange, "latex", booktabs = T) %>% 
  kable_styling(latex_options = c( "scale_down"), full_width = F)




```

```{r Spotted Seatrout Freeze}
# Spotted seatrout freeze baseline
#I had to first subset into the 10 year frame I wanted (no averaging)
subset7 <- bag.seines %>%
  filter(YEAR > 2009 & YEAR < 2020 ) %>% 
  group_by(MAJOR_AREA_CODE)
#summarize(mean(rd_CPUE)) %>%
#rename("CPUE" = "mean(rd_CPUE)")

#Then I had to subset for only the months I wanted for spotted seatrout (june - end of dec)
subset8 <- subset7 %>% 
  filter(MONTH > 5 ) %>% 
  group_by(MAJOR_AREA_CODE)

ggplot(subset8, mapping = aes(x=JULIAN_DATE, y = sst_CPUE)) + geom_point() + theme_classic()

#Final step = Averaging for the baseline
RE.SST10yr.freeze <- subset8 %>% 
  group_by(MAJOR_AREA_CODE) %>% 
  summarize(mean(sst_CPUE)) %>% 
  rename("CPUE" = "mean(sst_CPUE)")

RE.SST10yr.freeze$SPECIES <- "Spotted Seatrout"
RE.SST10yr.freeze$AVERAGE <- "10 yrs"

## post storm calculations = 2 post storm recruitment windows
RE.SST1yr.freeze <- bag.seines %>%
  filter(between(DATE, as.Date('2021-06-01'), as.Date('2021-12-31'))) %>% 
  group_by(MAJOR_AREA_CODE) %>%
  summarize(mean(sst_CPUE)) %>%
  rename("CPUE" = "mean(sst_CPUE)")

RE.SST1yr.freeze$SPECIES <- "Spotted Seatrout"
RE.SST1yr.freeze$AVERAGE <- "1st year"


RE.SST2nd.freeze <- bag.seines %>%
  filter(between(DATE, as.Date('2022-06-01'), as.Date('2022-12-31'))) %>% 
  group_by(MAJOR_AREA_CODE) %>%
  summarize(mean(sst_CPUE)) %>%
  rename("CPUE" = "mean(sst_CPUE)")

RE.SST2nd.freeze$SPECIES <- "Spotted Seatrout"
RE.SST2nd.freeze$AVERAGE <- "2nd year"

RE.SSTbyyear.Freeze <- rbind(RE.SST10yr.freeze,RE.SST1yr.freeze,RE.SST2nd.freeze)


#Plotting
ggplot(data = RE.SSTbyyear.Freeze , mapping = aes(x = MAJOR_AREA_CODE, y =  CPUE, fill = AVERAGE)) +  geom_bar(stat="identity", color="black", position=position_dodge()) + scale_fill_grey() + theme_classic() + labs(
  title = "10 yr avg vs post storm avg for SST across bays using NEW baselines",
  x = "Major bays",
  y = "Catch per Unit Effort (#/hectare)"
) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))


## PERCENT CHANGES
#make it wide:
RE.SST.PerChange.freeze <- spread(RE.SSTbyyear.Freeze, AVERAGE, CPUE)

## Add the column to put in the percent change values
RE.SST.PerChange.freeze$first_perChange <- NA
RE.SST.PerChange.freeze$second_perChange <- NA

# for loop calculating per change for the first year
for (i in 1:nrow(RE.SST.PerChange.freeze)){
  RE.SST.PerChange.freeze$first_perChange[i] = format(((RE.SST.PerChange.freeze$`1st year`[i] - RE.SST.PerChange.freeze$`10 yrs`[i]) /RE.SST.PerChange.freeze$`10 yrs`[i]) * 100 , scientific = F)
}

#for loop for calculating per change for the 2nd year to the baseline = 
for (i in 1:nrow(RE.SST.PerChange.freeze)){
  RE.SST.PerChange.freeze$second_perChange[i] = format(((RE.SST.PerChange.freeze$`2nd year`[i] - RE.SST.PerChange.freeze$`10 yrs`[i]) /RE.SST.PerChange.freeze$`10 yrs`[i]) * 100 , scientific = F)
}

## Per change values need to be converted to numeric values before plotting

RE.SST.PerChange.freeze$first_perChange <- as.numeric(RE.SST.PerChange.freeze$first_perChange)

RE.SST.PerChange.freeze$second_perChange <- as.numeric(RE.SST.PerChange.freeze$second_perChange)

##Plot
RE.SST.PerChange.freeze %>%
  ggplot() +
  geom_point(aes(x=MAJOR_AREA_CODE, y=first_perChange, color = 'First Year'), size = 5) + geom_point(aes(x=MAJOR_AREA_CODE, y = second_perChange, color = 'Second Year'), size = 5) + theme_classic() +theme(axis.text.x = element_text(angle=45, hjust=1)) +
  My_Theme + scale_color_manual(values = c("#D81B60", "#1E88E5")) +
  geom_hline(yintercept = 0) + geom_segment(
    aes(x = MAJOR_AREA_CODE, y = first_perChange, xend = MAJOR_AREA_CODE, yend = second_perChange),
    arrow = arrow(length = unit(0.04, units = "npc")),
    size = 0.5
  ) + scale_y_continuous(n.breaks = 20 ) +#ylim(-60,60) +
  labs(
    y = "Percent Change (%)",
    x = "Bay Location",
    colour = "Post Storm"
  ) 



```



# Black Drum 

```{r Black drum Hurricane}
## Recruitment window is April to end of oct 
#I had to first subset into the 10 year frame I wanted (no averaging)
subset9 <- bag.seines %>%
  filter(YEAR > 2006 & YEAR < 2017 ) %>% 
  group_by(MAJOR_AREA_CODE)


#Then I had to subset for only the months I wanted for black drum (April to end of oct)
subset10 <- subset9 %>% 
  filter(MONTH > 3 & MONTH < 11 ) %>% 
  group_by(MAJOR_AREA_CODE)

ggplot(subset10, mapping = aes(x=JULIAN_DATE, y = bd_CPUE)) + geom_point() + theme_classic()

#Final step = Averaging for the baseline
RE.BD10yr.hurricane <- subset10 %>% 
  group_by(MAJOR_AREA_CODE) %>% 
  summarize(mean(bd_CPUE)) %>% 
  rename("CPUE" = "mean(bd_CPUE)")

RE.BD10yr.hurricane$SPECIES <- "Black Drum"
RE.BD10yr.hurricane$AVERAGE <- "10 yrs"

## post storm calculations = 2 post storm recruitment windows
RE.BD1yr.hurricane <- bag.seines %>%
  filter(between(DATE, as.Date('2018-04-01'), as.Date('2018-10-31'))) %>% 
  group_by(MAJOR_AREA_CODE) %>%
  summarize(mean(bd_CPUE)) %>%
  rename("CPUE" = "mean(bd_CPUE)")

RE.BD1yr.hurricane$SPECIES <- "Black Drum"
RE.BD1yr.hurricane$AVERAGE <- "1st year"


RE.BD2nd.hurricane <- bag.seines %>%
  filter(between(DATE, as.Date('2019-04-01'), as.Date('2019-10-31'))) %>% 
  group_by(MAJOR_AREA_CODE) %>%
  summarize(mean(bd_CPUE)) %>%
  rename("CPUE" = "mean(bd_CPUE)")

RE.BD2nd.hurricane$SPECIES <- "Black Drum"
RE.BD2nd.hurricane$AVERAGE <- "2nd year"

RE.BDbyyear.Hurr <- rbind(RE.BD10yr.hurricane,RE.BD1yr.hurricane,RE.BD2nd.hurricane)


#Plotting
ggplot(data = RE.BDbyyear.Hurr , mapping = aes(x = MAJOR_AREA_CODE, y =  CPUE, fill = AVERAGE)) +  geom_bar(stat="identity", color="black", position=position_dodge()) + scale_fill_grey() + theme_classic() + labs(
  title = "10 yr avg vs post storm avg for BD across bays using NEW baselines",
  x = "Major bays",
  y = "Catch per Unit Effort (#/hectare)"
) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

## PERCENT CHANGES
#make it wide:
RE.BD.Spread.PerChange <- spread(RE.BDbyyear.Hurr, AVERAGE, CPUE)

## Add the column to put in the percent change values
RE.BD.Spread.PerChange$first_perChange <- NA
RE.BD.Spread.PerChange$second_perChange <- NA

# for loop calculating per change for the first year
for (i in 1:nrow(RE.BD.Spread.PerChange)){
  RE.BD.Spread.PerChange$first_perChange[i] = format(((RE.BD.Spread.PerChange$`1st year`[i] - RE.BD.Spread.PerChange$`10 yrs`[i]) /RE.BD.Spread.PerChange$`10 yrs`[i]) * 100 , scientific = F)
}

#for loop for calculating per change for the 2nd year to the baseline = 
for (i in 1:nrow(RE.BD.Spread.PerChange)){
  RE.BD.Spread.PerChange$second_perChange[i] = format(((RE.BD.Spread.PerChange$`2nd year`[i] - RE.BD.Spread.PerChange$`10 yrs`[i]) /RE.BD.Spread.PerChange$`10 yrs`[i]) * 100 , scientific = F)
}

## Per change values need to be converted to numeric values before plotting

RE.BD.Spread.PerChange$first_perChange <- as.numeric(RE.BD.Spread.PerChange$first_perChange)

RE.BD.Spread.PerChange$second_perChange <- as.numeric(RE.BD.Spread.PerChange$second_perChange)

##Plot
RE.BD.Spread.PerChange %>%
  ggplot() +
  geom_point(aes(x=MAJOR_AREA_CODE, y=first_perChange), color = '#D81B60') + geom_point(aes(x=MAJOR_AREA_CODE, y = second_perChange), color = '#1E88E5') + theme_classic() + theme(axis.text.x = element_text(angle=90, hjust=1)) + geom_hline(yintercept = 0) + geom_segment(
    aes(x = MAJOR_AREA_CODE, y = first_perChange, xend = MAJOR_AREA_CODE, yend = second_perChange),
    arrow = arrow(length = unit(0.02, units = "npc")),
    size = 0.3
  ) + labs(
    y = "Percent Change",
    x = "Bay Location",
    color = "legend",
    title = "BD during hurricane harvey with NEW baselines"
  )


```


```{r Black Drum Freeze}

# black drum freeze baseline
#I had to first subset into the 10 year frame I wanted (no averaging)
subset11 <- bag.seines %>%
  filter(YEAR > 2009 & YEAR < 2020 ) %>% 
  group_by(MAJOR_AREA_CODE)

#Then I had to subset for only the months I wanted for black drum (April - end of oct)
subset12 <- subset11 %>% 
  filter(MONTH > 3 & MONTH < 11 ) %>% 
  group_by(MAJOR_AREA_CODE)

ggplot(subset12, mapping = aes(x=JULIAN_DATE, y = bd_CPUE)) + geom_point() + theme_classic()

#Final step = Averaging for the baseline
RE.BD10yr.freeze <- subset12 %>% 
  group_by(MAJOR_AREA_CODE) %>% 
  summarize(mean(bd_CPUE)) %>% 
  rename("CPUE" = "mean(bd_CPUE)")

RE.BD10yr.freeze$SPECIES <- "Black Drum"
RE.BD10yr.freeze$AVERAGE <- "10 yrs"

## post storm calculations = 2 post storm recruitment windows
RE.BD1yr.freeze <- bag.seines %>%
  filter(between(DATE, as.Date('2021-04-01'), as.Date('2021-10-31'))) %>% 
  group_by(MAJOR_AREA_CODE) %>%
  summarize(mean(bd_CPUE)) %>%
  rename("CPUE" = "mean(bd_CPUE)")

RE.BD1yr.freeze$SPECIES <- "Black Drum"
RE.BD1yr.freeze$AVERAGE <- "1st year"


RE.BD2nd.freeze <- bag.seines %>%
  filter(between(DATE, as.Date('2022-04-01'), as.Date('2022-10-31'))) %>% 
  group_by(MAJOR_AREA_CODE) %>%
  summarize(mean(bd_CPUE)) %>%
  rename("CPUE" = "mean(bd_CPUE)")

RE.BD2nd.freeze$SPECIES <- "Black Drum"
RE.BD2nd.freeze$AVERAGE <- "2nd year"

RE.BDbyyear.Freeze <- rbind(RE.BD10yr.freeze,RE.BD1yr.freeze,RE.BD2nd.freeze)


#Plotting
ggplot(data = RE.BDbyyear.Freeze , mapping = aes(x = MAJOR_AREA_CODE, y =  CPUE, fill = AVERAGE)) +  geom_bar(stat="identity", color="black", position=position_dodge()) + scale_fill_grey() + theme_classic() + labs(
  title = "10 yr avg vs post storm avg for BD across bays using NEW baselines",
  x = "Major bays",
  y = "Catch per Unit Effort (#/hectare)"
) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))


## PERCENT CHANGES
#make it wide:
RE.BD.PerChange.freeze <- spread(RE.BDbyyear.Freeze, AVERAGE, CPUE)

## Add the column to put in the percent change values
RE.BD.PerChange.freeze$first_perChange <- NA
RE.BD.PerChange.freeze$second_perChange <- NA

# for loop calculating per change for the first year
for (i in 1:nrow(RE.BD.PerChange.freeze)){
  RE.BD.PerChange.freeze$first_perChange[i] = format(((RE.BD.PerChange.freeze$`1st year`[i] - RE.BD.PerChange.freeze$`10 yrs`[i]) /RE.BD.PerChange.freeze$`10 yrs`[i]) * 100 , scientific = F)
}

#for loop for calculating per change for the 2nd year to the baseline = 
for (i in 1:nrow(RE.BD.PerChange.freeze)){
  RE.BD.PerChange.freeze$second_perChange[i] = format(((RE.BD.PerChange.freeze$`2nd year`[i] - RE.BD.PerChange.freeze$`10 yrs`[i]) /RE.BD.PerChange.freeze$`10 yrs`[i]) * 100 , scientific = F)
}

## Per change values need to be converted to numeric values before plotting

RE.BD.PerChange.freeze$first_perChange <- as.numeric(RE.BD.PerChange.freeze$first_perChange)

RE.BD.PerChange.freeze$second_perChange <- as.numeric(RE.BD.PerChange.freeze$second_perChange)

##Plot


RE.BD.PerChange.freeze %>%
    ggplot() +
  geom_point(aes(x=MAJOR_AREA_CODE, y=first_perChange, color = 'First Year'), size = 5) + geom_point(aes(x=MAJOR_AREA_CODE, y = second_perChange, color = 'Second Year'), size = 5) + theme_classic() +theme(axis.text.x = element_text(angle=45, hjust=1)) +
  My_Theme + scale_color_manual(values = c("#D81B60", "#1E88E5")) +
  geom_hline(yintercept = 0) + geom_segment(
    aes(x = MAJOR_AREA_CODE, y = first_perChange, xend = MAJOR_AREA_CODE, yend = second_perChange),
    arrow = arrow(length = unit(0.04, units = "npc")),
    size = 0.5
  ) + scale_y_continuous(n.breaks = 15 )  +
  labs(
    y = "Percent Change (%)",
    x = "Bay Location",
    colour = "Post Storm"
  ) 


```



# Southern Flounder

```{r Souther Flounder Hurricane}

## Recruitment window is feb to end of july

#I had to first subset into the 10 year frame I wanted (no averaging)
subset13 <- bag.seines %>%
  filter(YEAR > 2006 & YEAR < 2017 ) %>% 
  group_by(MAJOR_AREA_CODE)


#Then I had to subset for only the months I wanted for southern flounder (feb - end of july)
subset14 <- subset13 %>% 
  filter(MONTH > 1 & MONTH < 8 ) %>% 
  group_by(MAJOR_AREA_CODE)

ggplot(subset14, mapping = aes(x=JULIAN_DATE, y = sf_CPUE)) + geom_point() + theme_classic()

#Final step = Averaging for the baseline
RE.SF10yr.hurricane <- subset14 %>% 
  group_by(MAJOR_AREA_CODE) %>% 
  summarize(mean(sf_CPUE)) %>% 
  rename("CPUE" = "mean(sf_CPUE)")

RE.SF10yr.hurricane$SPECIES <- "Southern Flounder"
RE.SF10yr.hurricane$AVERAGE <- "10 yrs"

## post storm calculations = 2 post storm recruitment windows
RE.SF1yr.hurricane <- bag.seines %>%
  filter(between(DATE, as.Date('2018-02-01'), as.Date('2018-07-31'))) %>% 
  group_by(MAJOR_AREA_CODE) %>%
  summarize(mean(sf_CPUE)) %>%
  rename("CPUE" = "mean(sf_CPUE)")

RE.SF1yr.hurricane$SPECIES <- "Southern Flounder"
RE.SF1yr.hurricane$AVERAGE <- "1st year"


RE.SF2nd.hurricane <- bag.seines %>%
  filter(between(DATE, as.Date('2019-02-01'), as.Date('2019-07-31'))) %>% 
  group_by(MAJOR_AREA_CODE) %>%
  summarize(mean(sf_CPUE)) %>%
  rename("CPUE" = "mean(sf_CPUE)")

RE.SF2nd.hurricane$SPECIES <- "Southern Flounder"
RE.SF2nd.hurricane$AVERAGE <- "2nd year"

RE.SFbyyear.Hurr <- rbind(RE.SF10yr.hurricane,RE.SF1yr.hurricane,RE.SF2nd.hurricane)


#Plotting
ggplot(data = RE.SFbyyear.Hurr , mapping = aes(x = MAJOR_AREA_CODE, y =  CPUE, fill = AVERAGE)) +  geom_bar(stat="identity", color="black", position=position_dodge()) + scale_fill_grey() + theme_classic() + labs(
  title = "10 yr avg vs post storm avg for SF across bays using NEW baselines",
  x = "Major bays",
  y = "Catch per Unit Effort (#/hectare)"
) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

## PERCENT CHANGES
#make it wide:
RE.SF.Spread.PerChange <- spread(RE.SFbyyear.Hurr, AVERAGE, CPUE)

## Add the column to put in the percent change values
RE.SF.Spread.PerChange$first_perChange <- NA
RE.SF.Spread.PerChange$second_perChange <- NA

# for loop calculating per change for the first year
for (i in 1:nrow(RE.SF.Spread.PerChange)){
  RE.SF.Spread.PerChange$first_perChange[i] = format(((RE.SF.Spread.PerChange$`1st year`[i] - RE.SF.Spread.PerChange$`10 yrs`[i]) /RE.SF.Spread.PerChange$`10 yrs`[i]) * 100 , scientific = F)
}

#for loop for calculating per change for the 2nd year to the baseline = 
for (i in 1:nrow(RE.SF.Spread.PerChange)){
  RE.SF.Spread.PerChange$second_perChange[i] = format(((RE.SF.Spread.PerChange$`2nd year`[i] - RE.SF.Spread.PerChange$`10 yrs`[i]) /RE.SF.Spread.PerChange$`10 yrs`[i]) * 100 , scientific = F)
}

## Per change values need to be converted to numeric values before plotting

RE.SF.Spread.PerChange$first_perChange <- as.numeric(RE.SF.Spread.PerChange$first_perChange)

RE.SF.Spread.PerChange$second_perChange <- as.numeric(RE.SF.Spread.PerChange$second_perChange)

##Plot
RE.SF.Spread.PerChange %>%
  ggplot() +
  geom_point(aes(x=MAJOR_AREA_CODE, y=first_perChange), color = '#D81B60') + geom_point(aes(x=MAJOR_AREA_CODE, y = second_perChange), color = '#1E88E5') + theme_classic() + theme(axis.text.x = element_text(angle=90, hjust=1)) + geom_hline(yintercept = 0) + geom_segment(
    aes(x = MAJOR_AREA_CODE, y = first_perChange, xend = MAJOR_AREA_CODE, yend = second_perChange),
    arrow = arrow(length = unit(0.02, units = "npc")),
    size = 0.3
  ) + labs(
    y = "Percent Change",
    x = "Bay Location",
    color = "legend",
    title = "SF during hurricane harvey with NEW baselines"
  )


```

```{r Southern Flounder Freeze}
# southern flounder freeze baseline
#I had to first subset into the 10 year frame I wanted (no averaging)
subset15 <- bag.seines %>%
  filter(YEAR > 2009 & YEAR < 2020 ) %>% 
  group_by(MAJOR_AREA_CODE)

#Then I had to subset for only the months I wanted for southern flounder feb -end of july
subset16 <- subset15 %>% 
  filter(MONTH > 1 & MONTH < 8 ) %>% 
  group_by(MAJOR_AREA_CODE)

ggplot(subset16, mapping = aes(x=JULIAN_DATE, y = sf_CPUE)) + geom_point() + theme_classic()

#Final step = Averaging for the baseline
RE.SF10yr.freeze <- subset16 %>% 
  group_by(MAJOR_AREA_CODE) %>% 
  summarize(mean(sf_CPUE)) %>% 
  rename("CPUE" = "mean(sf_CPUE)")

RE.SF10yr.freeze$SPECIES <- "Southern Flounder"
RE.SF10yr.freeze$AVERAGE <- "10 yrs"

## post storm calculations = 2 post storm recruitment windows
RE.SF1yr.freeze <- bag.seines %>%
  filter(between(DATE, as.Date('2021-02-22'), as.Date('2021-07-31'))) %>% 
  group_by(MAJOR_AREA_CODE) %>%
  summarize(mean(sf_CPUE)) %>%
  rename("CPUE" = "mean(sf_CPUE)")

RE.SF1yr.freeze$SPECIES <- "Southern Flounder"
RE.SF1yr.freeze$AVERAGE <- "1st year"


RE.SF2nd.freeze <- bag.seines %>%
  filter(between(DATE, as.Date('2022-02-22'), as.Date('2022-07-31'))) %>% 
  group_by(MAJOR_AREA_CODE) %>%
  summarize(mean(sf_CPUE)) %>%
  rename("CPUE" = "mean(sf_CPUE)")

RE.SF2nd.freeze$SPECIES <- "Southern Flounder"
RE.SF2nd.freeze$AVERAGE <- "2nd year"

RE.SFbyyear.Freeze <- rbind(RE.SF10yr.freeze,RE.SF1yr.freeze,RE.SF2nd.freeze)


#Plotting
ggplot(data = RE.SFbyyear.Freeze , mapping = aes(x = MAJOR_AREA_CODE, y =  CPUE, fill = AVERAGE)) +  geom_bar(stat="identity", color="black", position=position_dodge()) + scale_fill_grey() + theme_classic() + labs(
  title = "10 yr avg vs post storm avg for SF across bays using NEW baselines",
  x = "Major bays",
  y = "Catch per Unit Effort (#/hectare)"
) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))


## PERCENT CHANGES
#make it wide:
RE.SF.PerChange.freeze <- spread(RE.SFbyyear.Freeze, AVERAGE, CPUE)

## Add the column to put in the percent change values
RE.SF.PerChange.freeze$first_perChange <- NA
RE.SF.PerChange.freeze$second_perChange <- NA

# for loop calculating per change for the first year
for (i in 1:nrow(RE.SF.PerChange.freeze)){
  RE.SF.PerChange.freeze$first_perChange[i] = format(((RE.SF.PerChange.freeze$`1st year`[i] - RE.SF.PerChange.freeze$`10 yrs`[i]) /RE.SF.PerChange.freeze$`10 yrs`[i]) * 100 , scientific = F)
}

#for loop for calculating per change for the 2nd year to the baseline = 
for (i in 1:nrow(RE.SF.PerChange.freeze)){
  RE.SF.PerChange.freeze$second_perChange[i] = format(((RE.SF.PerChange.freeze$`2nd year`[i] - RE.SF.PerChange.freeze$`10 yrs`[i]) /RE.SF.PerChange.freeze$`10 yrs`[i]) * 100 , scientific = F)
}

## Per change values need to be converted to numeric values before plotting

RE.SF.PerChange.freeze$first_perChange <- as.numeric(RE.SF.PerChange.freeze$first_perChange)

RE.SF.PerChange.freeze$second_perChange <- as.numeric(RE.SF.PerChange.freeze$second_perChange)

##Plot
RE.SF.PerChange.freeze %>%
  ggplot() +
  geom_point(aes(x=MAJOR_AREA_CODE, y=first_perChange), color = '#D81B60') + geom_point(aes(x=MAJOR_AREA_CODE, y = second_perChange), color = '#1E88E5') + theme_classic() + theme(axis.text.x = element_text(angle=90, hjust=1)) + geom_hline(yintercept = 0) + geom_segment(
    aes(x = MAJOR_AREA_CODE, y = first_perChange, xend = MAJOR_AREA_CODE, yend = second_perChange),
    arrow = arrow(length = unit(0.02, units = "npc")),
    size = 0.3
  ) + labs(
    y = "Percent Change",
    x = "Bay Location",
    color = "legend",
    title = "SF during freeze with NEW baselines"
  )


```


# Interannual Variation
## Here we calculate the year to year percent change in the 10 year baseline period. From these numbers we created boxplots and then put thme on top of the percent change figures to give a range of expected interanual variablity. 

This is organized by species:
- Spotted seatrout and Hurricane
- Spotted seatrout and Freeze 
- Black Drum and Hurricane
- Black Drum and Freeze
- SF and Hurricane
- SF and Freeze

I am putting red drum last given their unique recruitment window

# Spotted seatrout Added Boxplot
```{r Spotted Seatrout and Hurricane }
# Testing percent change averages pt 2
sp.hur <- subset6 %>% 
  group_by(MAJOR_AREA_CODE,YEAR) %>% 
  summarize(mean(sst_CPUE)) %>% 
  rename("CPUE" = "mean(sst_CPUE)")

sp.hur$SPECIES <- "Spotted Seatrout"

sp.hur$MAJOR_AREA_CODE <- as.character(sp.hur$MAJOR_AREA_CODE)

#nested for loop for the calculations
bayTitle <- unique(sp.hur$MAJOR_AREA_CODE)
yearly_change <-  data.frame(matrix(ncol = 3, nrow = 0))
colnames(yearly_change) <- c('Bays', 'Year', 'per_change')

for (i in 1:length(bayTitle)){
  newdataCheck <- sp.hur %>% 
    filter(MAJOR_AREA_CODE == bayTitle[i]) %>% 
    arrange(YEAR)
  for (j in 1:(nrow(newdataCheck)-1)) {
    changeCheck <- format(((newdataCheck$CPUE[j+1]-newdataCheck$CPUE[j])/newdataCheck$CPUE[j]) * 100, scientific = F)
    newrows <- data.frame(Bays = bayTitle[i], Year = newdataCheck$YEAR[j+1], per_change =changeCheck)
    yearly_change <- rbind(yearly_change, newrows)
  }
}

#done

#boxplot making
library(tidyverse)
library("hrbrthemes")
library(viridis)

yearly_change$Bays <- as.factor(yearly_change$Bays)
library(forcats)
levels(yearly_change$Bays)
yearly_change$Bays <- fct_inorder(yearly_change$Bays)
yearly_change$per_change <- as.numeric(yearly_change$per_change)


yearly_change %>%
  ggplot( aes(x=Bays, y=per_change, fill=Bays)) +
    geom_boxplot() +
    scale_fill_viridis(discrete = TRUE, alpha=0.6) +
    geom_jitter(color="black", size=1, alpha=0.6) +
    theme_ipsum() + theme_classic() +
    theme(
      legend.position="none",
      plot.title = element_text(size=11),
      axis.text.x = element_text(angle=45, hjust=1)
    ) 

### Adding it to the percent change plot
RE.SST.Spread.PerChange %>%
  ggplot() +
  geom_point(aes(x=MAJOR_AREA_CODE, y=first_perChange, color = 'First Year'), size = 5) +
  geom_point(aes(x=MAJOR_AREA_CODE, y = second_perChange, color = 'Second Year'), size = 5) + 
  geom_boxplot(data = yearly_change, aes(x=Bays, y=per_change, fill=Bays), coef=0, outlier.shape = NA) +
   scale_fill_viridis(discrete = TRUE, alpha=0.2) +
    theme_ipsum()+
  theme_classic() + theme(axis.text.x = element_text(angle=45, hjust=1)) +
  My_Theme + scale_color_manual(values = c("#D81B60", "#1E88E5")) +
  geom_hline(yintercept = 0) + geom_segment(
    aes(x = MAJOR_AREA_CODE, y = first_perChange, xend = MAJOR_AREA_CODE, yend = second_perChange),
    arrow = arrow(length = unit(0.04, units = "npc")),
    size = 0.5
  ) + scale_y_continuous(n.breaks = 20 ) + labs(
    y = "Percent Change (%)",
    x = "Bay Location",
    colour = "Post Storm",
    title = "spotted seatrout and HH"
  )


```


```{r Spotted seatrout and Freeze}
# Testing percent change averages pt 2
sp.freeze <- subset8 %>% 
  group_by(MAJOR_AREA_CODE,YEAR) %>% 
  summarize(mean(sst_CPUE)) %>% 
  rename("CPUE" = "mean(sst_CPUE)")

sp.freeze$SPECIES <- "Spotted Seatrout"

sp.freeze$MAJOR_AREA_CODE <- as.character(sp.freeze$MAJOR_AREA_CODE)

#nested for loop for the calculations
sp.bayTitle <- unique(sp.freeze$MAJOR_AREA_CODE)
sp.yearly_change <-  data.frame(matrix(ncol = 3, nrow = 0))
colnames(sp.yearly_change) <- c('Bays', 'Year', 'per_change')

for (i in 1:length(sp.bayTitle)){
  new.sp <- sp.freeze %>% 
    filter(MAJOR_AREA_CODE == sp.bayTitle[i]) %>% 
    arrange(YEAR)
  for (j in 1:(nrow(new.sp)-1)) {
    change.sp <- format(((new.sp$CPUE[j+1]-new.sp$CPUE[j])/new.sp$CPUE[j]) * 100, scientific = F)
    newrow.sp <- data.frame(Bays = sp.bayTitle[i], Year = new.sp$YEAR[j+1], per_change =change.sp)
    sp.yearly_change <- rbind(sp.yearly_change, newrow.sp)
  }
}

#done

#boxplot making
library(tidyverse)
library("hrbrthemes")
library(viridis)
library(forcats)

#re-ordering the levels
sp.yearly_change$Bays <- as.factor(sp.yearly_change$Bays)

levels(sp.yearly_change$Bays)
sp.yearly_change$Bays <- fct_inorder(sp.yearly_change$Bays)
sp.yearly_change$per_change <- as.numeric(sp.yearly_change$per_change)


sp.yearly_change %>%
  ggplot( aes(x=Bays, y=per_change, fill=Bays)) +
    geom_boxplot() +
    scale_fill_viridis(discrete = TRUE, alpha=0.6) +
    geom_jitter(color="black", size=1, alpha=0.6) +
    theme_ipsum() + theme_classic() +
    theme(
      legend.position="none",
      plot.title = element_text(size=11),
      axis.text.x = element_text(angle=45, hjust=1)
    ) 

### Adding it to the percent change plot
RE.SST.PerChange.freeze %>%
  ggplot() +
  geom_point(aes(x=MAJOR_AREA_CODE, y=first_perChange, color = 'First Year'), size = 5) +
  geom_point(aes(x=MAJOR_AREA_CODE, y = second_perChange, color = 'Second Year'), size = 5) + 
  geom_boxplot(data = sp.yearly_change, aes(x=Bays, y=per_change, fill=Bays), coef=0, outlier.shape = NA) +
   scale_fill_viridis(discrete = TRUE, alpha=0.2) +
    theme_ipsum()+
  theme_classic() + theme(axis.text.x = element_text(angle=45, hjust=1)) +
  My_Theme + scale_color_manual(values = c("#D81B60", "#1E88E5")) +
  geom_hline(yintercept = 0) + geom_segment(
    aes(x = MAJOR_AREA_CODE, y = first_perChange, xend = MAJOR_AREA_CODE, yend = second_perChange),
    arrow = arrow(length = unit(0.04, units = "npc")),
    size = 0.5
  ) + scale_y_continuous(n.breaks = 20 ) + labs(
    y = "Percent Change (%)",
    x = "Bay Location",
    colour = "Post Storm",
    title = "spotted seatrout and Freeze"
  )
```

#Black drum added boxplot

```{r Black Drum and Hurricane Harvey}
# Testing percent change averages pt 2
bd.hur <- subset10 %>% 
  group_by(MAJOR_AREA_CODE,YEAR) %>% 
  summarize(mean(bd_CPUE)) %>% 
  rename("CPUE" = "mean(bd_CPUE)")

bd.hur$SPECIES <- "Black Drum"

bd.hur$MAJOR_AREA_CODE <- as.character(bd.hur$MAJOR_AREA_CODE)

#nested for loop for the calculations
bdHH.bayTitle <- unique(bd.hur$MAJOR_AREA_CODE)
bdHH.yearly_change <-  data.frame(matrix(ncol = 3, nrow = 0))
colnames(bdHH.yearly_change) <- c('Bays', 'Year', 'per_change')

for (i in 1:length(bdHH.bayTitle)){
  new.bdHH <- bd.hur %>% 
    filter(MAJOR_AREA_CODE == bdHH.bayTitle[i]) %>% 
    arrange(YEAR)
  for (j in 1:(nrow(new.bdHH)-1)) {
    change.bdHH <- format(((new.bdHH$CPUE[j+1]-new.bdHH$CPUE[j])/new.bdHH$CPUE[j]) * 100, scientific = F)
    newrow.bdHH <- data.frame(Bays = bdHH.bayTitle[i], Year = new.bdHH$YEAR[j+1], per_change =change.bdHH)
    bdHH.yearly_change <- rbind(bdHH.yearly_change, newrow.bdHH)
  }
}

#done

#boxplot making
library(tidyverse)
library("hrbrthemes")
library(viridis)
library(forcats)

#re-ordering the levels
bdHH.yearly_change$Bays <- as.factor(bdHH.yearly_change$Bays)

levels(bdHH.yearly_change$Bays)
bdHH.yearly_change$Bays <- fct_inorder(bdHH.yearly_change$Bays)
bdHH.yearly_change$per_change <- as.numeric(bdHH.yearly_change$per_change)


bdHH.yearly_change %>%
  ggplot( aes(x=Bays, y=per_change, fill=Bays)) +
    geom_boxplot(outlier.shape = NA, coef=0) +
    scale_fill_viridis(discrete = TRUE, alpha=0.6)  +
    theme_ipsum() + theme_classic() +
    theme(
      legend.position="none",
      plot.title = element_text(size=11),
      axis.text.x = element_text(angle=45, hjust=1)
    ) 

### Adding it to the percent change plot
RE.BD.Spread.PerChange %>%
  ggplot() +
  geom_point(aes(x=MAJOR_AREA_CODE, y=first_perChange, color = 'First Year'), size = 5) +
  geom_point(aes(x=MAJOR_AREA_CODE, y = second_perChange, color = 'Second Year'), size = 5) + 
  geom_boxplot(data = bdHH.yearly_change, aes(x=Bays, y=per_change, fill=Bays), coef=0, outlier.shape = NA) +
   scale_fill_viridis(discrete = TRUE, alpha=0.2) +
    theme_ipsum()+
  theme_classic() + theme(axis.text.x = element_text(angle=45, hjust=1)) +
  My_Theme + scale_color_manual(values = c("#D81B60", "#1E88E5")) +
  geom_hline(yintercept = 0) + geom_segment(
    aes(x = MAJOR_AREA_CODE, y = first_perChange, xend = MAJOR_AREA_CODE, yend = second_perChange),
    arrow = arrow(length = unit(0.04, units = "npc")),
    size = 0.5
  ) + scale_y_continuous(n.breaks = 20 ) + labs(
    y = "Percent Change (%)",
    x = "Bay Location",
    colour = "Post Storm",
    title = "black drum and hurricane harvey"
  ) + ylim(-100,500)




```

```{r Black Drum and Freeze}
# Testing percent change averages pt 2
bd.freeze <- subset12 %>% 
  group_by(MAJOR_AREA_CODE,YEAR) %>% 
  summarize(mean(bd_CPUE)) %>% 
  rename("CPUE" = "mean(bd_CPUE)")

bd.freeze$SPECIES <- "Black Drum"

bd.freeze$MAJOR_AREA_CODE <- as.character(bd.freeze$MAJOR_AREA_CODE)

#nested for loop for the calculations
bd.bayTitle <- unique(bd.freeze$MAJOR_AREA_CODE)
bd.yearly_change <-  data.frame(matrix(ncol = 3, nrow = 0))
colnames(bd.yearly_change) <- c('Bays', 'Year', 'per_change')

for (i in 1:length(bd.bayTitle)){
  new.bd <- bd.freeze %>% 
    filter(MAJOR_AREA_CODE == bd.bayTitle[i]) %>% 
    arrange(YEAR)
  for (j in 1:(nrow(new.bd)-1)) {
    change.bd <- format(((new.bd$CPUE[j+1]-new.bd$CPUE[j])/new.bd$CPUE[j]) * 100, scientific = F)
    newrow.bd <- data.frame(Bays = bd.bayTitle[i], Year = new.bd$YEAR[j+1], per_change =change.bd)
    bd.yearly_change <- rbind(bd.yearly_change, newrow.bd)
  }
}

#done

#boxplot making
library(tidyverse)
library("hrbrthemes")
library(viridis)
library(forcats)

#re-ordering the levels
bd.yearly_change$Bays <- as.factor(bd.yearly_change$Bays)

levels(bd.yearly_change$Bays)
bd.yearly_change$Bays <- fct_inorder(bd.yearly_change$Bays)
bd.yearly_change$per_change <- as.numeric(bd.yearly_change$per_change)


bd.yearly_change %>%
  ggplot( aes(x=Bays, y=per_change, fill=Bays)) +
    geom_boxplot(outlier.shape = NA, coef=0) +
    scale_fill_viridis(discrete = TRUE, alpha=0.6)  +
    theme_ipsum() + theme_classic() +
    theme(
      legend.position="none",
      plot.title = element_text(size=11),
      axis.text.x = element_text(angle=45, hjust=1)
    ) 

### Adding it to the percent change plot
RE.BD.PerChange.freeze %>%
  ggplot() +
  geom_point(aes(x=MAJOR_AREA_CODE, y=first_perChange, color = 'First Year'), size = 5) +
  geom_point(aes(x=MAJOR_AREA_CODE, y = second_perChange, color = 'Second Year'), size = 5) + 
  geom_boxplot(data = bd.yearly_change, aes(x=Bays, y=per_change, fill=Bays), coef=0, outlier.shape = NA) +
   scale_fill_viridis(discrete = TRUE, alpha=0.2) +
    theme_ipsum()+
  theme_classic() + theme(axis.text.x = element_text(angle=45, hjust=1)) +
  My_Theme + scale_color_manual(values = c("#D81B60", "#1E88E5")) +
  geom_hline(yintercept = 0) + geom_segment(
    aes(x = MAJOR_AREA_CODE, y = first_perChange, xend = MAJOR_AREA_CODE, yend = second_perChange),
    arrow = arrow(length = unit(0.04, units = "npc")),
    size = 0.5
  ) + scale_y_continuous(n.breaks = 20 ) + labs(
    y = "Percent Change (%)",
    x = "Bay Location",
    colour = "Post Storm",
    title = "black drum and freeze"
  ) 


```


# Southern Flounder added box plots

```{r Southern Flounder and Hurricanes}
# Testing percent change averages pt 2
sf.hur <- subset14 %>% 
  group_by(MAJOR_AREA_CODE,YEAR) %>% 
  summarize(mean(sf_CPUE)) %>% 
  rename("CPUE" = "mean(sf_CPUE)")

sf.hur$SPECIES <- "Southern flounder"

sf.hur$MAJOR_AREA_CODE <- as.character(sf.hur$MAJOR_AREA_CODE)

#nested for loop for the calculations
sfHH.bayTitle <- unique(sf.hur$MAJOR_AREA_CODE)
sfHH.yearly_change <-  data.frame(matrix(ncol = 3, nrow = 0))
colnames(sfHH.yearly_change) <- c('Bays', 'Year', 'per_change')

for (i in 1:length(sfHH.bayTitle)){
  new.sfHH <- sf.hur %>% 
    filter(MAJOR_AREA_CODE == sfHH.bayTitle[i]) %>% 
    arrange(YEAR)
  for (j in 1:(nrow(new.sfHH)-1)) {
    change.sfHH <- format(((new.sfHH$CPUE[j+1]-new.sfHH$CPUE[j])/new.sfHH$CPUE[j]) * 100, scientific = F)
    newrow.sfHH <- data.frame(Bays = sfHH.bayTitle[i], Year = new.sfHH$YEAR[j+1], per_change =change.sfHH)
    sfHH.yearly_change <- rbind(sfHH.yearly_change, newrow.sfHH)
  }
}

#done


#re-ordering the levels
sfHH.yearly_change$Bays <- as.factor(sfHH.yearly_change$Bays)

levels(sfHH.yearly_change$Bays)
sfHH.yearly_change$Bays <- fct_inorder(sfHH.yearly_change$Bays)
sfHH.yearly_change$per_change <- as.numeric(sfHH.yearly_change$per_change)


sfHH.yearly_change %>%
  ggplot( aes(x=Bays, y=per_change, fill=Bays)) +
    geom_boxplot(outlier.shape = NA, coef=0) +
    scale_fill_viridis(discrete = TRUE, alpha=0.6)  +
    theme_ipsum() + theme_classic() +
    theme(
      legend.position="none",
      plot.title = element_text(size=11),
      axis.text.x = element_text(angle=45, hjust=1)
    ) + ylim(-100,500)

### Adding it to the percent change plot
RE.SF.Spread.PerChange %>%
  ggplot() +
  geom_point(aes(x=MAJOR_AREA_CODE, y=first_perChange, color = 'First Year'), size = 5) +
  geom_point(aes(x=MAJOR_AREA_CODE, y = second_perChange, color = 'Second Year'), size = 5) + 
  geom_boxplot(data = sfHH.yearly_change, aes(x=Bays, y=per_change, fill=Bays), coef=0, outlier.shape = NA) +
   scale_fill_viridis(discrete = TRUE, alpha=0.2) +
    theme_ipsum()+
  theme_classic() + theme(axis.text.x = element_text(angle=45, hjust=1)) +
  My_Theme + scale_color_manual(values = c("#D81B60", "#1E88E5")) +
  geom_hline(yintercept = 0) + geom_segment(
    aes(x = MAJOR_AREA_CODE, y = first_perChange, xend = MAJOR_AREA_CODE, yend = second_perChange),
    arrow = arrow(length = unit(0.04, units = "npc")),
    size = 0.5
  ) + scale_y_continuous(n.breaks = 20 ) + labs(
    y = "Percent Change (%)",
    x = "Bay Location",
    colour = "Post Storm",
    title = "southern flounder and hurricane harvey"
  ) + ylim(-100,200)


```

```{r southern flounder and freeze}
# Testing percent change averages pt 2
sf.freeze <- subset16 %>% 
  group_by(MAJOR_AREA_CODE,YEAR) %>% 
  summarize(mean(sf_CPUE)) %>% 
  rename("CPUE" = "mean(sf_CPUE)")

sf.freeze$SPECIES <- "Southern flounder"

sf.freeze$MAJOR_AREA_CODE <- as.character(sf.freeze$MAJOR_AREA_CODE)

#nested for loop for the calculations
sf.bayTitle <- unique(sf.freeze$MAJOR_AREA_CODE)
sf.yearly_change <-  data.frame(matrix(ncol = 3, nrow = 0))
colnames(sf.yearly_change) <- c('Bays', 'Year', 'per_change')

for (i in 1:length(sf.bayTitle)){
  new.sf <- sf.freeze %>% 
    filter(MAJOR_AREA_CODE == sf.bayTitle[i]) %>% 
    arrange(YEAR)
  for (j in 1:(nrow(new.sf)-1)) {
    change.sf <- format(((new.sf$CPUE[j+1]-new.sf$CPUE[j])/new.sf$CPUE[j]) * 100, scientific = F)
    newrow.sf <- data.frame(Bays = sf.bayTitle[i], Year = new.sf$YEAR[j+1], per_change =change.sf)
    sf.yearly_change <- rbind(sf.yearly_change, newrow.sf)
  }
}

#done

#boxplot making


#re-ordering the levels
sf.yearly_change$Bays <- as.factor(sf.yearly_change$Bays)

levels(sf.yearly_change$Bays)
sf.yearly_change$Bays <- fct_inorder(sf.yearly_change$Bays)
sf.yearly_change$per_change <- as.numeric(sf.yearly_change$per_change)


sf.yearly_change %>%
  ggplot( aes(x=Bays, y=per_change, fill=Bays)) +
    geom_boxplot(outlier.shape = NA, coef=0) +
    scale_fill_viridis(discrete = TRUE, alpha=0.6)  +
    theme_ipsum() + theme_classic() +
    theme(
      legend.position="none",
      plot.title = element_text(size=11),
      axis.text.x = element_text(angle=45, hjust=1)
    ) + ylim(-120,200)

### Adding it to the percent change plot
RE.SF.PerChange.freeze %>%
  ggplot() +
  geom_point(aes(x=MAJOR_AREA_CODE, y=first_perChange, color = 'First Year'), size = 5) +
  geom_point(aes(x=MAJOR_AREA_CODE, y = second_perChange, color = 'Second Year'), size = 5) + 
  geom_boxplot(data = sf.yearly_change, aes(x=Bays, y=per_change, fill=Bays), coef=0, outlier.shape = NA) +
   scale_fill_viridis(discrete = TRUE, alpha=0.2) +
    theme_ipsum()+
  theme_classic() + theme(axis.text.x = element_text(angle=45, hjust=1)) +
  My_Theme + scale_color_manual(values = c("#D81B60", "#1E88E5")) +
  geom_hline(yintercept = 0) + geom_segment(
    aes(x = MAJOR_AREA_CODE, y = first_perChange, xend = MAJOR_AREA_CODE, yend = second_perChange),
    arrow = arrow(length = unit(0.04, units = "npc")),
    size = 0.5
  ) + scale_y_continuous(n.breaks = 20 ) + labs(
    y = "Percent Change (%)",
    x = "Bay Location",
    colour = "Post Storm",
    title = "southern flounder and freeze"
  ) + ylim(-120,400)

```

# Red Drum added boxplots

```{r Red Drum and freeze}

## Setting up the data frame, a function and a for loop needed to be made
rd.freeze <- finalsubset
rd.freeze <- add_column(rd.freeze, RecruitmentYear = NA)

freeze_function <- function(DATE){
  if (DATE > "2009-09-30" & DATE < "2010-06-01"){
    (RecruitmentYear = 'Year 1')
  }else if(DATE > "2010-09-30" & DATE < "2011-06-01"){
    (RecruitmentYear = 'Year 2')
  }else if (DATE > "2011-09-30" & DATE < "2012-06-01"){
    (RecruitmentYear = 'Year 3')
  }else if (DATE > "2012-09-30" & DATE < "2013-06-01"){
    (RecruitmentYear = 'Year 4')
  }else if (DATE > "2013-09-30" & DATE < "2014-06-01"){
    (RecruitmentYear = 'Year 5')
  }else if (DATE > "2014-09-30" & DATE < "2015-06-01"){
    (RecruitmentYear = 'Year 6')
  }else if (DATE > "2015-09-30" & DATE < "2016-06-01"){
    (RecruitmentYear = 'Year 7')
  }else if (DATE > "2016-09-30" & DATE < "2017-06-01"){
    (RecruitmentYear = 'Year 8')
  }else if (DATE > "2017-09-30" & DATE < "2018-06-01"){
    (RecruitmentYear = 'Year 9')
  }else(RecruitmentYear = 'Year 10')
  return(RecruitmentYear)
}

for (i in 1:nrow(rd.freeze)){
  DATE <- rd.freeze[i, "DATE"]
  rd.freeze[i,"RecruitmentYear"] <- freeze_function(DATE)
}

### Now it can start like the rest of the r chunks
rd.freeze2 <- rd.freeze %>% 
  group_by(MAJOR_AREA_CODE,RecruitmentYear) %>% 
  summarize(mean(rd_CPUE)) %>% 
  rename("CPUE" = "mean(rd_CPUE)")

rd.freeze2$SPECIES <- "Red Drum"

# Re-ordering the years in the factors
rd.freeze2$MAJOR_AREA_CODE <- as.character(rd.freeze2$MAJOR_AREA_CODE)
rd.freeze2$RecruitmentYear <- as.factor(rd.freeze2$RecruitmentYear)
rd.freeze2$RecruitmentYear <- factor(rd.freeze2$RecruitmentYear, levels = c("Year 1", "Year 2", "Year 3", "Year 4", "Year 5", "Year 6", "Year 7", "Year 8", "Year 9", "Year 10"))

levels(rd.freeze2$RecruitmentYear)

#nested for loop for the calculations
rd.bayTitle <- unique(rd.freeze2$MAJOR_AREA_CODE)
rd.yearly_change <-  data.frame(matrix(ncol = 3, nrow = 0))
colnames(rd.yearly_change) <- c('Bays', 'Year', 'per_change')

for (i in 1:length(rd.bayTitle)){
  new.rd <- rd.freeze2 %>% 
    filter(MAJOR_AREA_CODE == rd.bayTitle[i]) %>% 
    arrange(RecruitmentYear)
  for (j in 1:(nrow(new.rd)-1)) {
    change.rd <- format(((new.rd$CPUE[j+1]-new.rd$CPUE[j])/new.rd$CPUE[j]) * 100, scientific = F)
    newrow.rd <- data.frame(Bays = rd.bayTitle[i], Year = new.rd$RecruitmentYear[j+1], per_change =change.rd)
    rd.yearly_change <- rbind(rd.yearly_change, newrow.rd)
  }
}

#done


#re-ordering the levels for the bays
rd.yearly_change$Bays <- as.factor(rd.yearly_change$Bays)

levels(rd.yearly_change$Bays)
rd.yearly_change$Bays <- fct_inorder(rd.yearly_change$Bays)
rd.yearly_change$per_change <- as.numeric(rd.yearly_change$per_change)


rd.yearly_change %>%
  ggplot( aes(x=Bays, y=per_change, fill=Bays)) +
    geom_boxplot(outlier.shape = NA, coef=0) +
    scale_fill_viridis(discrete = TRUE, alpha=0.6)  +
    theme_ipsum() + theme_classic() +
    theme(
      legend.position="none",
      plot.title = element_text(size=11),
      axis.text.x = element_text(angle=45, hjust=1)
    ) + ylim(-100,200)

### Adding it to the percent change plot
RE.RD.freeze.PerChange %>%
  ggplot() +
  geom_point(aes(x=MAJOR_AREA_CODE, y=first_perChange, color = 'First Year'), size = 5) +
  geom_point(aes(x=MAJOR_AREA_CODE, y = second_perChange, color = 'Second Year'), size = 5) + 
  geom_boxplot(data = rd.yearly_change, aes(x=Bays, y=per_change, fill=Bays), coef=0, outlier.shape = NA) +
   scale_fill_viridis(discrete = TRUE, alpha=0.2) +
    theme_ipsum()+
  theme_classic() + theme(axis.text.x = element_text(angle=45, hjust=1)) +
  My_Theme + scale_color_manual(values = c("#D81B60", "#1E88E5")) +
  geom_hline(yintercept = 0) + geom_segment(
    aes(x = MAJOR_AREA_CODE, y = first_perChange, xend = MAJOR_AREA_CODE, yend = second_perChange),
    arrow = arrow(length = unit(0.04, units = "npc")),
    size = 0.5
  ) + scale_y_continuous(n.breaks = 20 ) + labs(
    y = "Percent Change (%)",
    x = "Bay Location",
    colour = "Post Storm",
    title = "red drum and freeze"
  ) + ylim(-100,250)


```

```{r red drum and hurricane}

## Setting up the data frame, a function and a for loop needed to be made
rd.hur <- finalcheck
rd.hur <- add_column(rd.hur, RecruitmentYear = NA)

my_function <- function(DATE){
  if (DATE > "2007-09-30" & DATE < "2008-06-01"){
    (RecruitmentYear = 'Year 1')
  }else if(DATE > "2008-09-30" & DATE < "2009-06-01"){
    (RecruitmentYear = 'Year 2')
  }else if (DATE > "2009-09-30" & DATE < "2010-06-01"){
    (RecruitmentYear = 'Year 3')
  }else if (DATE > "2010-09-30" & DATE < "2011-06-01"){
    (RecruitmentYear = 'Year 4')
  }else if (DATE > "2011-09-30" & DATE < "2012-06-01"){
    (RecruitmentYear = 'Year 5')
  }else if (DATE > "2012-09-30" & DATE < "2013-06-01"){
    (RecruitmentYear = 'Year 6')
  }else if (DATE > "2013-09-30" & DATE < "2014-06-01"){
    (RecruitmentYear = 'Year 7')
  }else if (DATE > "2014-09-30" & DATE < "2015-06-01"){
    (RecruitmentYear = 'Year 8')
  }else if (DATE > "2015-09-30" & DATE < "2016-06-01"){
    (RecruitmentYear = 'Year 9')
  }else(RecruitmentYear = 'Year 10')
  return(RecruitmentYear)
}

for (i in 1:nrow(rd.hur)){
  DATE <- rd.hur[i, "DATE"]
  rd.hur[i,"RecruitmentYear"] <- my_function(DATE)
}

### Now it can start like the rest of the r chunks
rd.hur2 <- rd.hur %>% 
  group_by(MAJOR_AREA_CODE,RecruitmentYear) %>% 
  summarize(mean(rd_CPUE)) %>% 
  rename("CPUE" = "mean(rd_CPUE)")

rd.hur2$SPECIES <- "Red Drum"

# Re-ordering the years in the factors
rd.hur2$MAJOR_AREA_CODE <- as.character(rd.hur2$MAJOR_AREA_CODE)
rd.hur2$RecruitmentYear <- as.factor(rd.hur2$RecruitmentYear)
rd.hur2$RecruitmentYear <- factor(rd.hur2$RecruitmentYear, levels = c("Year 1", "Year 2", "Year 3", "Year 4", "Year 5", "Year 6", "Year 7", "Year 8", "Year 9", "Year 10"))

levels(rd.hur2$RecruitmentYear)

#nested for loop for the calculations
rdHH.bayTitle <- unique(rd.hur2$MAJOR_AREA_CODE)
rdHH.yearly_change <-  data.frame(matrix(ncol = 3, nrow = 0))
colnames(rdHH.yearly_change) <- c('Bays', 'Year', 'per_change')

for (i in 1:length(rdHH.bayTitle)){
  new.rdHH <- rd.hur2 %>% 
    filter(MAJOR_AREA_CODE == rdHH.bayTitle[i]) %>% 
    arrange(RecruitmentYear)
  for (j in 1:(nrow(new.rdHH)-1)) {
    change.rdHH <- format(((new.rdHH$CPUE[j+1]-new.rdHH$CPUE[j])/new.rdHH$CPUE[j]) * 100, scientific = F)
    newrow.rdHH <- data.frame(Bays = rdHH.bayTitle[i], Year = new.rdHH$RecruitmentYear[j+1], per_change =change.rdHH)
    rdHH.yearly_change <- rbind(rdHH.yearly_change, newrow.rdHH)
  }
}

#done


#re-ordering the levels for the bays
rdHH.yearly_change$Bays <- as.factor(rdHH.yearly_change$Bays)

levels(rdHH.yearly_change$Bays)
rdHH.yearly_change$Bays <- fct_inorder(rdHH.yearly_change$Bays)
rdHH.yearly_change$per_change <- as.numeric(rdHH.yearly_change$per_change)


rdHH.yearly_change %>%
  ggplot( aes(x=Bays, y=per_change, fill=Bays)) +
    geom_boxplot(outlier.shape = NA, coef=0) +
    scale_fill_viridis(discrete = TRUE, alpha=0.6)  +
    theme_ipsum() + theme_classic() +
    theme(
      legend.position="none",
      plot.title = element_text(size=11),
      axis.text.x = element_text(angle=45, hjust=1)
    ) + ylim(-100,250)

### Adding it to the percent change plot
RE.RD.Spread.PerChange %>%
  ggplot() +
  geom_point(aes(x=MAJOR_AREA_CODE, y=first_perChange, color = 'First Year'), size = 5) +
  geom_point(aes(x=MAJOR_AREA_CODE, y = second_perChange, color = 'Second Year'), size = 5) + 
  geom_boxplot(data = rdHH.yearly_change, aes(x=Bays, y=per_change, fill=Bays), coef=0, outlier.shape = NA) +
   scale_fill_viridis(discrete = TRUE, alpha=0.2) +
    theme_ipsum()+
  theme_classic() + theme(axis.text.x = element_text(angle=45, hjust=1)) +
  My_Theme + scale_color_manual(values = c("#D81B60", "#1E88E5")) +
  geom_hline(yintercept = 0) + geom_segment(
    aes(x = MAJOR_AREA_CODE, y = first_perChange, xend = MAJOR_AREA_CODE, yend = second_perChange),
    arrow = arrow(length = unit(0.04, units = "npc")),
    size = 0.5
  ) + scale_y_continuous(n.breaks = 20 ) + labs(
    y = "Percent Change (%)",
    x = "Bay Location",
    colour = "Post Storm",
    title = "red drum and hurricane harvey"
  ) + ylim(-100,250)


```

# Hurricane Figure 3
```{r 4 panel figure code}
grey <- "#D3D3D3"

A.hurr <- RE.RD.Spread.PerChange %>%
  ggplot() +
  geom_point(aes(x=MAJOR_AREA_CODE, y=first_perChange, color = 'First Year', shape = 'First Year'), size = 4) +
  geom_point(aes(x=MAJOR_AREA_CODE, y = second_perChange, color = 'Second Year', shape = 'Second Year'), size = 4) + 
  geom_boxplot(data = rdHH.yearly_change, aes(x=Bays, y=per_change, alpha = 0.1), coef=0, outlier.shape = NA) + scale_fill_manual(values = NA) + guides(alpha = "none") +
  theme_classic() + theme(axis.text.x = element_text(angle=45, hjust=1)) +
  My_Theme + scale_color_manual(values = c("#D81B60", "#1E88E5"),
                                name = "Post Storm",
                                labels = c("First Year", "Second Year")) +
  scale_shape_manual(name = "Post Storm",
                     labels = c("First Year", "Second Year"),
                     values = c(19, 17)) +
  geom_hline(yintercept = 0) + geom_segment(
    aes(x = MAJOR_AREA_CODE, y = first_perChange, xend = MAJOR_AREA_CODE, yend = second_perChange),
    arrow = arrow(length = unit(0.03, units = "npc")),
    size = 0.4
  ) + scale_y_continuous(n.breaks = 20 ) + labs(
    y = "Percent Change (%)",
    x = "Bay Location",
    colour = "Post Storm",
    title = "Red Drum"
  ) + ylim(-100,250) 
#ggsave("Figure3A.jpg", width = 10, height = 8, units = c("in"), dpi = 300, bg = "white")

B.hurr <- RE.SST.Spread.PerChange %>%
  ggplot() +
  geom_point(aes(x=MAJOR_AREA_CODE, y=first_perChange, color = 'First Year', shape = 'First Year'), size = 4) +
  geom_point(aes(x=MAJOR_AREA_CODE, y = second_perChange, color = 'Second Year', shape = 'Second Year'), size = 4) + 
  geom_boxplot(data = yearly_change, aes(x=Bays, y=per_change, alpha = 0.1), coef=0, outlier.shape = NA) + scale_fill_manual(values = NA) + guides(alpha="none") +
  theme_classic() + theme(axis.text.x = element_text(angle=45, hjust=1)) +
  My_Theme + scale_color_manual(values = c("#D81B60", "#1E88E5"),
                                name = "Post Storm",
                                labels = c("First Year", "Second Year")) +
  scale_shape_manual(name = "Post Storm",
                     labels = c("First Year", "Second Year"),
                     values = c(19, 17)) +
  geom_hline(yintercept = 0) + geom_segment(
    aes(x = MAJOR_AREA_CODE, y = first_perChange, xend = MAJOR_AREA_CODE, yend = second_perChange),
    arrow = arrow(length = unit(0.03, units = "npc")),
    size = 0.4
  ) + scale_y_continuous(n.breaks = 20 ) + labs(
    y = "Percent Change (%)",
    x = "Bay Location",
    colour = "Post Storm",
    title = "Spotted Seatrout"
  ) + ylim(-150,250)

#ggsave("Figure3B.jpg", width = 10, height = 8, units = c("in"), dpi = 300, bg = "white")

C.hurr <- RE.BD.Spread.PerChange %>%
  ggplot() +
  geom_point(aes(x=MAJOR_AREA_CODE, y=first_perChange, color = 'First Year', shape = 'First Year'), size = 4) +
  geom_point(aes(x=MAJOR_AREA_CODE, y = second_perChange, color = 'Second Year', shape = 'Second Year'), size = 4) + 
  geom_boxplot(data = bdHH.yearly_change, aes(x=Bays, y=per_change, alpha = 0.1), coef=0, outlier.shape = NA) + scale_fill_manual(values = NA) + guides(alpha = "none") +
  theme_classic() + theme(axis.text.x = element_text(angle=45, hjust=1)) +
  My_Theme + scale_color_manual(values = c("#D81B60", "#1E88E5"),
                                name = "Post Storm",
                                labels = c("First Year", "Second Year")) +
  scale_shape_manual(name = "Post Storm",
                     labels = c("First Year", "Second Year"),
                     values = c(19, 17)) +
  geom_hline(yintercept = 0) + geom_segment(
    aes(x = MAJOR_AREA_CODE, y = first_perChange, xend = MAJOR_AREA_CODE, yend = second_perChange),
    arrow = arrow(length = unit(0.03, units = "npc")),
    size = 0.4
  ) + scale_y_continuous(n.breaks = 20 ) + labs(
    y = "Percent Change (%)",
    x = "Bay Location",
    colour = "Post Storm",
    title = "Black Drum "
  ) + ylim(-100,500)

#ggsave("Figure3C.jpg", width = 10, height = 8, units = c("in"), dpi = 300, bg = "white")


D.hurr <- RE.SF.Spread.PerChange %>%
  ggplot() +
  geom_point(aes(x=MAJOR_AREA_CODE, y=first_perChange, color = 'First Year', shape = 'First Year'), size = 4) +
  geom_point(aes(x=MAJOR_AREA_CODE, y = second_perChange, color = 'Second Year', shape = 'Second Year'), size = 4) + 
  geom_boxplot(data = sfHH.yearly_change, aes(x=Bays, y=per_change, alpha = 0.1), coef=0, outlier.shape = NA) + scale_fill_manual(values = NA) + guides(alpha = "none")+
  theme_classic() + theme(axis.text.x = element_text(angle=45, hjust=1)) +
  My_Theme + scale_color_manual(values = c("#D81B60", "#1E88E5"),
                                name = "Post Storm",
                                labels = c("First Year", "Second Year")) +
  scale_shape_manual(name = "Post Storm",
                     labels = c("First Year", "Second Year"),
                     values = c(19, 17)) +
  geom_hline(yintercept = 0) + geom_segment(
    aes(x = MAJOR_AREA_CODE, y = first_perChange, xend = MAJOR_AREA_CODE, yend = second_perChange),
    arrow = arrow(length = unit(0.03, units = "npc")),
    size = 0.4
  ) + scale_y_continuous(n.breaks = 20 ) + labs(
    y = "Percent Change (%)",
    x = "Bay Location",
    colour = "Post Storm",
    title = "Southern Flounder"
  ) + ylim(-100,200)

#ggsave("Figure3D.jpg", width = 10, height = 8, units = c("in"), dpi = 300, bg = "white")


fig.3 <- ggarrange(A.hurr + rremove("ylab") + rremove("xlab") + rremove("x.text"), B.hurr + rremove("ylab") + rremove("xlab")+ rremove("x.text"), C.hurr + rremove("ylab")+ rremove("xlab"), D.hurr + rremove("ylab")+ rremove("xlab"), labels = c("A","B", "C", "D"), common.legend = TRUE,ncol = 2, nrow = 2, legend = "right")

fig.3

annotate_figure(fig.3,
                bottom = text_grob("Bay Location", size = 16, hjust = 1),
                left = text_grob("Percent Change (%)", rot = 90, size = 16))




#ggsave("Figure3.jpg", width = 10, height = 8, units = c("in"), dpi = 300, bg = "white")


```


#Freeze figure 4
```{r 4 panel figure for freeze event}

A.freeze <- RE.RD.freeze.PerChange %>%
  ggplot() +
  geom_point(aes(x=MAJOR_AREA_CODE, y=first_perChange, color = 'First Year', shape = 'First Year'), size = 4) +
  geom_point(aes(x=MAJOR_AREA_CODE, y = second_perChange, color = 'Second Year', shape = 'Second Year'), size = 4) + 
  geom_boxplot(data = rd.yearly_change, aes(x=Bays, y=per_change, alpha = 0.1), coef=0, outlier.shape = NA) + scale_fill_manual(values = NA) + guides(alpha = "none") +
  theme_classic() + theme(axis.text.x = element_text(angle=45, hjust=1)) +
  My_Theme +scale_color_manual(values = c("#D81B60", "#1E88E5"),
                                name = "Post Storm",
                                labels = c("First Year", "Second Year")) +
  scale_shape_manual(name = "Post Storm",
                     labels = c("First Year", "Second Year"),
                     values = c(19, 17)) +
  geom_hline(yintercept = 0) + geom_segment(
    aes(x = MAJOR_AREA_CODE, y = first_perChange, xend = MAJOR_AREA_CODE, yend = second_perChange),
    arrow = arrow(length = unit(0.03, units = "npc")),
    size = 0.4
  ) + scale_y_continuous(n.breaks = 20 ) + labs(
    y = "Percent Change (%)",
    x = "Bay Location",
    colour = "Post Storm",
    title = "Red Drum"
  ) + ylim(-100,250)
  
#ggsave("Figure4A.jpg", width = 10, height = 8, units = c("in"), dpi = 300, bg = "white")

B.freeze <- RE.SST.PerChange.freeze %>%
  ggplot() +
  geom_point(aes(x=MAJOR_AREA_CODE, y=first_perChange, color = 'First Year', shape = 'First Year'), size = 4) +
  geom_point(aes(x=MAJOR_AREA_CODE, y = second_perChange, color = 'Second Year', shape = 'Second Year'), size = 4) + 
  geom_boxplot(data = sp.yearly_change, aes(x=Bays, y=per_change, alpha = 0.1), coef=0, outlier.shape = NA) + scale_fill_manual(values = NA) + guides(alpha = "none") +
  theme_classic() + theme(axis.text.x = element_text(angle=45, hjust=1)) +
  My_Theme + scale_color_manual(values = c("#D81B60", "#1E88E5"),
                                name = "Post Storm",
                                labels = c("First Year", "Second Year")) +
  scale_shape_manual(name = "Post Storm",
                     labels = c("First Year", "Second Year"),
                     values = c(19, 17)) +
  geom_hline(yintercept = 0) + geom_segment(
    aes(x = MAJOR_AREA_CODE, y = first_perChange, xend = MAJOR_AREA_CODE, yend = second_perChange),
    arrow = arrow(length = unit(0.03, units = "npc")),
    size = 0.4
  ) + scale_y_continuous(n.breaks = 20 ) + labs(
    y = "Percent Change (%)",
    x = "Bay Location",
    colour = "Post Storm",
    title = "Spotted Seatrout"
  ) + ylim(-100,300)

#ggsave("Figure4B.jpg", width = 10, height = 8, units = c("in"), dpi = 300, bg = "white") 

C.freeze <- RE.BD.PerChange.freeze %>%
  ggplot() +
  geom_point(aes(x=MAJOR_AREA_CODE, y=first_perChange, color = 'First Year', shape = 'First Year'), size = 4) +
  geom_point(aes(x=MAJOR_AREA_CODE, y = second_perChange, color = 'Second Year', shape = 'Second Year'), size = 4) + 
  geom_boxplot(data = bd.yearly_change, aes(x=Bays, y=per_change, alpha = 0.1 ), coef=0, outlier.shape = NA) + scale_fill_manual(values = NA) + guides(alpha = "none") +
  theme_classic() + theme(axis.text.x = element_text(angle=45, hjust=1)) +
  My_Theme + scale_color_manual(values = c("#D81B60", "#1E88E5"),
                                name = "Post Storm",
                                labels = c("First Year", "Second Year")) +
  scale_shape_manual(name = "Post Storm",
                     labels = c("First Year", "Second Year"),
                     values = c(19, 17)) +
  geom_hline(yintercept = 0) + geom_segment(
    aes(x = MAJOR_AREA_CODE, y = first_perChange, xend = MAJOR_AREA_CODE, yend = second_perChange),
    arrow = arrow(length = unit(0.03, units = "npc")),
    size = 0.4
  ) + scale_y_continuous(n.breaks = 20 ) + labs(
    y = "Percent Change (%)",
    x = "Bay Location",
    colour = "Post Storm",
    title = "Black Drum"
  ) + ylim(-200,1500)
#ggsave("Figure4C.jpg", width = 10, height = 8, units = c("in"), dpi = 300, bg = "white")  
  
D.freeze <- RE.SF.PerChange.freeze %>%
  ggplot() +
  geom_point(aes(x=MAJOR_AREA_CODE, y=first_perChange, color = 'First Year', shape = 'First Year'), size = 5) +
  geom_point(aes(x=MAJOR_AREA_CODE, y = second_perChange, color = 'Second Year', shape = 'Second Year'), size = 5) + 
  geom_boxplot(data = sf.yearly_change, aes(x=Bays, y=per_change, alpha = 0.1), coef=0, outlier.shape = NA) + scale_fill_manual(values = NA) + guides(alpha="none") +
  theme_classic() + theme(axis.text.x = element_text(angle=45, hjust=1)) +
  My_Theme + scale_color_manual(values = c("#D81B60", "#1E88E5"),
                                name = "Post Storm",
                                labels = c("First Year", "Second Year")) +
  scale_shape_manual(name = "Post Storm",
                     labels = c("First Year", "Second Year"),
                     values = c(19, 17)) +
  geom_hline(yintercept = 0) + geom_segment(
    aes(x = MAJOR_AREA_CODE, y = first_perChange, xend = MAJOR_AREA_CODE, yend = second_perChange),
    arrow = arrow(length = unit(0.03, units = "npc")),
    size = 0.4
  ) + scale_y_continuous(n.breaks = 20 ) + labs(
    y = "Percent Change (%)",
    x = "Bay Location",
    colour = "Post Storm",
    title = "Southern Flounder"
  ) + ylim(-120,400)
#ggsave("Figure4D.jpg", width = 10, height = 8, units = c("in"), dpi = 300, bg = "white")



fig.4 <- ggarrange(A.freeze+ rremove("ylab") + rremove("xlab") + rremove("x.text"), B.freeze + rremove("ylab") + rremove("xlab") + rremove("x.text"), C.freeze + rremove("ylab")+ rremove("xlab"), D.freeze + rremove("ylab")+ rremove("xlab"), labels = c("A","B", "C", "D"), common.legend = TRUE,ncol = 2, nrow = 2, legend = "right")

fig.4


annotate_figure(fig.4,
                bottom = text_grob("Bay Location", size = 16, hjust = 1),
                left = text_grob("Percent Change (%)", rot = 90, size = 16))

ggsave("Figure4.jpg", width = 10, height = 8, units = c("in"), dpi = 300, bg = "white")



```


